(this.webpackJsonpcloudui=this.webpackJsonpcloudui||[]).push([[0],{243:function(e,t,a){e.exports=a.p+"static/media/loading.d47e58c7.gif"},250:function(e,t,a){e.exports=a(521)},255:function(e,t,a){},257:function(e,t,a){},521:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(4),c=a.n(r),i=(a(255),a(256),a(257),a(45)),o=a(54),u=a(7),s=a(233),m=a.n(s),d="https://ratanajaya.com/",p=a(165),g=function(e){var t=e.children;return Object(p.useMediaQuery)({minWidth:801})?t:null},b=function(e){var t=e.children;return Object(p.useMediaQuery)({maxWidth:800})?t:null},f=a(530),E=a(534),h=a(538),v=a(540),x=a(536),y=a(551),C=a(552),I=a(553),k=a(554),w=a(555),j=a(556),O=a(557),A=a(246),S=a.n(A),P=a(122),T=a(36),R=a(241),q=a(532),F=a(533),M=a(92),D=a(541),N=a(542),z=a(543);function L(e){return e.charAt(0).toLowerCase()+e.slice(1)}function B(e,t){var a=e/t*100;return a<=100?a:100}var V=function(e){return function(t){var a=Object.assign({},t);return l.a.createElement(e,Object.assign({},a,{popInfo:function(e,t,a){q.a.info({title:e,content:l.a.createElement("span",null,t,JSON.stringify(a,null,2)),onOk:function(){},width:500})},popError:function(e,t,a){q.a.error({title:e,content:l.a.createElement("span",null,t,JSON.stringify(a,null,2)),onOk:function(){},width:500})},popApiError:function(e){if(null!=e.response){var t=e.response,a=t.status,n=t.statusText,r=t.data,c={title:"".concat(a," - ").concat(n),content:l.a.createElement("span",null,JSON.stringify(r,null,2)),onOk:function(){},width:500};a>=400&&a<500?q.a.warning(c):q.a.error(c)}else q.a.error(JSON.stringify(e))}}))}},G=q.a.confirm,W=a(60).default;function J(e,t){var a=3===t?{r:34,g:193,b:195}:2===t?{r:142,g:190,b:121}:{r:253,g:187,b:45},n=e<t?0:1;return"rgba(".concat(a.r,",").concat(a.g,",").concat(a.b,",").concat(n,")")}function H(e,t){return e>t&&(1===t||2===t)?"2px solid black":"0px"}function U(e){var t={width:"18px",height:"12px",marginRight:"2px",marginBottom:"2px"};return l.a.createElement(l.a.Fragment,null,"English"===e.language?l.a.createElement(M.a.GB,{style:t}):"Japanese"===e.language?l.a.createElement(M.a.JP,{style:t}):"Chinese"===e.language?l.a.createElement(M.a.CN,{style:t}):l.a.createElement(M.a.ID,{style:t}))}var Q=V((function(e){var t={view:function(){e.onView(e.albumCm)},edit:function(){e.onEdit(e.albumCm.albumId)},delete:function(){G({title:"Delete album ".concat(e.albumCm.fullTitle,"?"),icon:l.a.createElement(D.a,null),okText:"\xa0\xa0\xa0YES\xa0\xa0\xa0",okType:"danger",cancelText:"\xa0\xa0\xa0NO\xa0\xa0\xa0",onOk:function(){W.delete(d+"Crud/DeleteAlbum/"+e.albumCm.albumId).then((function(t){console.log("del success",t),e.onDelete(e.albumCm.albumId)})).catch((function(t){e.popApiError(t)}))},onCancel:function(){}})}},a=l.a.createElement(E.a,null,l.a.createElement(E.a.Item,{key:"1",onClick:t.edit},l.a.createElement(N.a,null),"Edit"),l.a.createElement(E.a.Item,{key:"2",onClick:t.delete},l.a.createElement(z.a,null),"Delete")),n=Object(R.a)({threshold:0,rootMargin:"300px 0px 300px 0px"}),r=Object(u.a)(n,3),c=r[0],i=r[1];return r[2],l.a.createElement("div",{ref:c,style:{paddingBottom:"8px",position:"relative"}},l.a.createElement(F.a,{overlay:a,trigger:["contextMenu"],disabled:!e.showContextMenu},l.a.createElement("div",{style:{textAlign:"center"}},l.a.createElement("div",{style:{height:"150px",width:"100%"}},l.a.createElement("div",{style:{display:"inline-block",position:"relative",height:"150px",width:"100%",maxWidth:"150px",borderLeft:e.albumCm.isRead?"":"1px solid #ddbe14"}},l.a.createElement("img",{onClick:t.view,style:{objectFit:"contain",height:"100%",width:"100%"},src:i?d+"Media/StreamResizedImage?librelPathBase64="+e.albumCm.coverInfo.uncPathEncoded+"&maxSize=150":"",alt:"img"}),e.albumCm.isRead?"":l.a.createElement("div",{style:{position:"absolute",height:0,width:0,left:"0px",top:"0px",borderLeft:"15px solid #ddbe14",borderRight:"15px solid transparent",borderBottom:"15px solid transparent"}}),l.a.createElement("div",{style:{position:"absolute",right:"3px",bottom:"3px",color:"white",lineHeight:"0px"}},e.albumCm.languages.map((function(e,t){return l.a.createElement(U,{language:e,key:t})}))),l.a.createElement("div",{style:{position:"absolute",right:"0px",bottom:"0px",height:"100%",width:"2px"}},[3,2,1].map((function(t,a){return l.a.createElement("div",{key:"tierBar-".concat(a),style:{width:"100%",height:"33%",backgroundColor:J(e.albumCm.tier,t),borderTop:H(e.albumCm.tier,t)}})}))),l.a.createElement("div",{style:{position:"absolute",left:"0px",bottom:"0px",width:"100%",height:"3px",backgroundColor:"white",display:e.albumCm.lastPageIndex>0?"block":"none"}},l.a.createElement("div",{style:{backgroundColor:"DodgerBlue",height:"100%",width:"".concat(B(e.albumCm.lastPageIndex+1,e.albumCm.pageCount),"%")}})))),l.a.createElement("span",{style:{fontSize:"12px",lineHeight:1.1}},e.albumCm.fullTitle))))})),K=a(535),Y=a(31),$=a(531),X=a(544),Z=a(545),_=a(546);var ee=function(e){var t=Object(n.useState)(0),a=Object(u.a)(t,2),r=a[0],c=a[1];Object(n.useEffect)((function(){c(e.initialValue+1)}),[e.initialValue]),Object(n.useEffect)((function(){w(e.pageName)}),[e.pageName]);var i=Object(n.useState)(!1),o=Object(u.a)(i,2),s=o[0],m=o[1],d=Object(n.useState)(!1),p=Object(u.a)(d,2),g=p[0],b=p[1],f=Object(n.useState)(0),E=Object(u.a)(f,2),x=E[0],y=E[1];Object(n.useEffect)((function(){void 0!==e.albumCm&&y(e.albumCm.tier)}),[e.albumCm]);var C=Object(n.useState)(""),I=Object(u.a)(C,2),k=I[0],w=I[1];return void 0===e.albumCm?l.a.createElement(l.a.Fragment,null):l.a.createElement(l.a.Fragment,null,l.a.createElement(q.a,{visible:e.visible,onCancel:e.onCancel,footer:null,closable:!1,centered:!0,style:{maxWidth:300}},l.a.createElement(h.a,null,l.a.createElement(v.a,{span:24,style:{marginBottom:15,textAlign:"center"}},l.a.createElement(K.a,{count:3,value:x,onChange:function(t){y(t),e.onTierChange(t)},style:{fontSize:"40px"}})),l.a.createElement(v.a,{span:24},l.a.createElement(Y.a,{type:"primary",onClick:function(){return e.onRecount()},style:{width:"100%"}},l.a.createElement(X.a,null),"Recount Pages")),l.a.createElement(v.a,{span:12,style:{textAlign:"left",marginTop:5}},l.a.createElement("input",{type:"number",value:r,onChange:function(t){return c(Math.min(Math.max(t.target.value,1),e.albumCm.pageCount))},style:{width:"97%",padding:"4px",WebkitBoxSizing:"border-box",borderRadius:"5px"}})),l.a.createElement(v.a,{span:12,style:{textAlign:"right",marginTop:5}},l.a.createElement(Y.a,{type:"primary",onClick:function(){return e.onJump(r-1)},style:{width:"97%",color:"white"}},l.a.createElement(Z.a,null),"Jump")),l.a.createElement(v.a,{span:24,style:{marginTop:5}},l.a.createElement(Y.a,{type:"primary",onClick:function(){return e.onUndoJump()},style:{width:"100%"}},l.a.createElement(_.a,null),"Undo Jump")),l.a.createElement(v.a,{span:24,style:{marginTop:5}},l.a.createElement(Y.a,{type:"primary",onClick:function(){e.onCancel(),m(!0)},style:{width:"100%"}},l.a.createElement(N.a,null),"Rename Page")),l.a.createElement(v.a,{span:24,style:{marginTop:5}},l.a.createElement(Y.a,{type:"danger",onClick:function(){e.onCancel(),b(!0)},style:{width:"100%"}},l.a.createElement(z.a,null),"Delete Page")))),l.a.createElement(q.a,{visible:s,footer:null,centered:!0,closable:!1,onCancel:function(){return m(!1)},style:{maxWidth:300,textAlign:"center"},bodyStyle:{backgroundColor:"grey",border:"1px solid black"}},l.a.createElement($.a.TextArea,{value:k,onChange:function(e){return w(e.target.value)},rows:2}),l.a.createElement(Y.a,{type:"primary",onClick:function(){m(!1),e.onRename(k)},style:{width:"100%"}},"Rename")),l.a.createElement(q.a,{visible:g,footer:null,centered:!0,closable:!1,onCancel:function(){return b(!1)},style:{maxWidth:300,textAlign:"center"},bodyStyle:{backgroundColor:"grey",border:"1px solid black"}},l.a.createElement("span",{style:{color:"white"}},"Are you sure to delete this page?"),l.a.createElement(Y.a,{type:"danger",onClick:function(){b(!1),e.onDelete()},style:{width:"100%"}},"Delete")))},te=q.a.confirm,ae=a(60).default;var ne=V((function(e){var t=Object(n.useState)([]),a=Object(u.a)(t,2),r=a[0],c=a[1];Object(n.useEffect)((function(){void 0!==e.albumId&&ae.get(d+"Crud/GetAlbumChapters?id=".concat(e.albumId)).then((function(e){c(e.data)})).catch((function(t){e.popApiError(t)}))}),[e.albumId]);var i=function(e){console.log("rename ",e)},o=function(t){console.log("delete ",t),te({title:"Delete chapter ".concat(t,"?"),icon:l.a.createElement(D.a,null),okText:"\xa0\xa0\xa0Yes\xa0\xa0\xa0",okType:"danger",cancelText:"\xa0\xa0\xa0No\xa0\xa0\xa0",onOk:function(){var a=encodeURIComponent(t);ae.delete(d+"Crud/DeleteAlbumChapter/".concat(e.albumId,"/").concat(a)).then((function(a){console.log("newPageCount",a.data),e.onChapterDeleteSuccess(a.data),c(r.filter((function(e){return e.title!==t})))})).catch((function(t){e.popApiError(t)}))},onCancel:function(){}})};return l.a.createElement(x.a,{placement:"left",closable:!1,onClose:e.onClose,visible:e.visible},l.a.createElement("div",{style:{padding:"10px"}},r.map((function(t,a){return l.a.createElement(h.a,{style:{marginBottom:"5px"},key:t.title},l.a.createElement(F.a,{overlay:l.a.createElement(E.a,null,l.a.createElement(E.a.Item,{key:"1",onClick:function(){return i(t.title)}},l.a.createElement(N.a,null),"Rename"),l.a.createElement(E.a.Item,{key:"2",onClick:function(){return o(t.title)}},l.a.createElement(z.a,null),"Delete")),trigger:["contextMenu"]},l.a.createElement(v.a,{span:10,onClick:function(){return e.onJumpToPage(t.pageIndex)}},l.a.createElement("img",{style:{objectFit:"contain",width:"100%",maxHeight:"128px",border:"1px solid white"},src:d+"Media/StreamResizedImage?librelPathBase64="+t.pageUncPath+"&maxSize=128",alt:"img"}))),l.a.createElement(v.a,{span:14},l.a.createElement("span",{style:{color:"white"}},t.title)))})),";"))})),le=a(243),re=a.n(le),ce=a(244),ie=a(60).default;var oe=function(e){return{content:{position:"relative",top:"0%",width:"100%",textAlign:"center",backgroundColor:e?"rgba(200, 200, 200, 0.3)":"rgba(0, 0, 0, 0)"},button:{position:"relative",boxSizing:"border-box",border:e?"1px solid black":"0px"}}},ue=function(e,t){return e?l.a.createElement("span",{style:{textAlign:"center",margin:"auto",textShadow:"-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black"}},t):""};function se(e){var t={objectFit:"contain",height:window.innerHeight,width:window.innerWidth},a={objectFit:"contain",height:0,width:0,position:"absolute"};return function(e){if(".webm"===e||".mp4"===e)return!0;return!1}(e.pageInfo.extension)?l.a.createElement("video",{autoPlay:!0,loop:!0,id:e.id,style:"q0"===e.queue?t:a,src:"q0"===e.queue?d+"Media/StreamPage?albumId="+e.albumId+"&alRelPathBase64="+e.pageInfo.uncPathEncoded:""},"video not showing"):l.a.createElement("img",{id:e.id,style:"q0"===e.queue?t:a,src:"q0"===e.queue||"q1"===e.queue?d+"Media/StreamPage?albumId="+e.albumId+"&alRelPathBase64="+e.pageInfo.uncPathEncoded:re.a,alt:"Not loaded"})}var me=V((function(e){console.log("MyReaderModal render");var t=Object(n.useState)({id:null,lpi:0,pages:[],indexes:{cPageI:0,pPageI:0,triad:"zenpen",zenpenIndex:0,chuhenIndex:0,kouhenIndex:0}}),a=Object(u.a)(t,2),r=a[0],c=a[1];Object(n.useEffect)((function(){void 0!==e.albumCm&&e.albumCm.albumId!==r.id&&ie.get(d+"File/GetAlbumPageInfos?id="+e.albumCm.albumId).then((function(t){c({id:e.albumCm.albumId,lpi:e.albumCm.lastPageIndex,pages:t.data,indexes:null})})).catch((function(e){alert("GetAlbumPageInfos "+e)}))}),[e.albumCm]),Object(n.useEffect)((function(){var e=r.lpi<r.pages.length?r.lpi:r.pages.length-1;o.jumpTo(e)}),[r.id]),Object(n.useEffect)((function(){return document.addEventListener("keydown",i,!1),function(){document.removeEventListener("keydown",i,!1)}}),[]);var i=function(e){27===e.keyCode&&o.close()},o={jumpTo:function(t,a){var n,l,i,o,u,s=r.pages.length-1,m=null!==(n=null===(l=r.indexes)||void 0===l?void 0:l.cPageI)&&void 0!==n?n:0,p=(i=t,o=0,u=s,Math.max(o,Math.min(i,u))),g=function(){function e(e,t,a,n){return{newTriad:e,zenpenIndex:t,chuhenIndex:a,kouhenIndex:n}}function t(e){var t=r.pages.length;return((p+e)%t+t)%t}return p%3===0?e("zenpen",p,t(1),t(-1)):p%3===1?e("chuhen",t(-1),p,t(1)):p%3===2?e("kouhen",t(1),t(-1),p):void 0}(),b=g.newTriad,f=g.zenpenIndex,E=g.chuhenIndex,h=g.kouhenIndex,v=r.pages;null!==a&&void 0!==a&&(v[a.index]=a.newPageInfo),c({indexes:{cPageI:p,pPageI:m,triad:b,zenpenIndex:f,chuhenIndex:E,kouhenIndex:h},id:r.id,lpi:r.lpi,pages:v}),null!=r.id&&t===r.pages.length-1&&ie.post(d+"Crud/UpdateAlbumOuterValue/",{albumId:r.id,lastPageIndex:t}).then((function(e){})).catch((function(t){e.popApiError(t)}))},rename:function(t,a){console.log("rename page ".concat(t," with name ").concat(a)),ie.post(d+"File/RenameFile",{albumId:r.id,pageIndex:t,newName:a}).then((function(e){var a={index:t,newPageInfo:e.data};console.log(a),o.jumpTo(r.indexes.cPageI-1,a)})).catch((function(t){e.popApiError(t)}))},delete:function(t){ie.delete(d+"File/DeleteFile/".concat(r.id,"/").concat(t)).then((function(a){e.onPageDeleteSuccess(r.id,t)})).catch((function(t){e.popApiError(t)}))},close:function(){e.onClose(r.id,r.indexes.cPageI)}},s={tierChange:function(t){ie.put(d+"Crud/UpdateAlbumTier",{albumId:r.id,tier:t}).then((function(e){console.log(e.data)})).catch((function(t){e.popApiError(t)}))},recount:function(){ie.post(d+"Crud/RecountAlbumPages",{albumId:r.id}).then((function(t){console.log("new page count",t.data),e.onChapterDeleteSuccess(r.id,t.data)})).catch((function(t){e.popApiError(t)}))}},m=Object(n.useState)(!1),p=Object(u.a)(m,2),g=p[0],b=p[1],f=Object(n.useState)(!1),E=Object(u.a)(f,2),x=E[0],y=E[1],C={rightTop:function(){o.close()},rightMid:function(){o.jumpTo(r.indexes.cPageI+1)},rightBot:function(){o.jumpTo(r.pages.length-1)},midTop:function(){},midMid:function(){b(!0)},midBot:function(){},leftTop:function(){y(!0)},leftMid:function(){o.jumpTo(r.indexes.cPageI-1)},leftBot:function(){o.jumpTo(0)}},I=Object(ce.useSwipeable)({onSwipedLeft:function(e){o.jumpTo(r.indexes.cPageI+1)},onSwipedRight:function(e){o.jumpTo(r.indexes.cPageI-1)}}),k=null!==r.indexes&&0===r.indexes.cPageI,w=oe(k),j={side:Object(T.a)({},w.button,{minHeight:.25*window.innerHeight}),mid:Object(T.a)({},w.button,{minHeight:.5*window.innerHeight})};if(null===r.indexes||0===r.pages.length)return l.a.createElement(l.a.Fragment,null);var O="zenpen"===r.indexes.triad?r.pages[r.indexes.zenpenIndex]:"chuhen"===r.indexes.triad?r.pages[r.indexes.chuhenIndex]:"kouhen"===r.indexes.triad?r.pages[r.indexes.kouhenIndex]:null,A=l.a.createElement(se,{id:"zenpen-page",albumId:r.id,pageInfo:r.pages[r.indexes.zenpenIndex],queue:"zenpen"===r.indexes.triad?"q0":"kouhen"===r.indexes.triad?"q1":"q2"}),S=l.a.createElement(se,{id:"chuhen-page",albumId:r.id,pageInfo:r.pages[r.indexes.chuhenIndex],queue:"chuhen"===r.indexes.triad?"q0":"zenpen"===r.indexes.triad?"q1":"q2"}),P=l.a.createElement(se,{id:"kouhen-page",albumId:r.id,pageInfo:r.pages[r.indexes.kouhenIndex],queue:"kouhen"===r.indexes.triad?"q0":"chuhen"===r.indexes.triad?"q1":"q2"});return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"overlay overlay-reader",style:{display:e.isOpen?"block":"none",zIndex:1}},l.a.createElement("div",{className:"overlay-content"},A,S,P),l.a.createElement("div",{className:"overlay",style:{zIndex:2}},l.a.createElement("div",{className:"overlay-content"},l.a.createElement("span",{className:"with-shadow"},O.name),l.a.createElement("div",{style:{position:"fixed",bottom:"0px",width:"100%",textAlign:"center"}},l.a.createElement("span",{className:"with-shadow"},r.indexes.cPageI+1,"/",r.pages.length)))),l.a.createElement("div",{className:"overlay",style:{zIndex:3}},l.a.createElement("div",Object.assign({style:w.content},I),l.a.createElement(h.a,null,l.a.createElement(v.a,{span:6},l.a.createElement("div",{onClick:C.leftTop,style:j.side},ue(k,"Browse Chapters"))),l.a.createElement(v.a,{span:12},l.a.createElement("div",{onClick:C.midTop,style:j.side})),l.a.createElement(v.a,{span:6},l.a.createElement("div",{onClick:C.rightTop,style:j.side},ue(k,"Close Album")))),l.a.createElement(h.a,null,l.a.createElement(v.a,{span:6},l.a.createElement("div",{onClick:C.leftMid,style:j.mid},ue(k,"Previous Page"))),l.a.createElement(v.a,{span:12},l.a.createElement("div",{onClick:C.midMid,style:j.mid},ue(k,"Context Menu")),l.a.createElement(ee,{albumCm:e.albumCm,initialValue:r.indexes.cPageI,pageName:O.name,onTierChange:s.tierChange,onRecount:function(){s.recount(),b(!1)},onJump:function(e){o.jumpTo(e),b(!1)},onUndoJump:function(){o.jumpTo(r.indexes.pPageI),b(!1)},visible:g,onRename:function(e){o.rename(r.indexes.cPageI,e),b(!1)},onDelete:function(){o.delete(r.indexes.cPageI),b(!1)},onCancel:function(){return b(!1)}})),l.a.createElement(v.a,{span:6},l.a.createElement("div",{onClick:C.rightMid,style:j.mid},ue(k,"Next Page")))),l.a.createElement(h.a,null,l.a.createElement(v.a,{span:6},l.a.createElement("div",{onClick:C.leftBot,style:j.side},ue(k,"First Page"))),l.a.createElement(v.a,{span:12},l.a.createElement("div",{onClick:C.midBot,style:j.side})),l.a.createElement(v.a,{span:6},l.a.createElement("div",{onClick:C.rightBot,style:j.side},ue(k,"Last Page"))))))),l.a.createElement(ne,{visible:x,onClose:function(){return y(!1)},albumId:r.id,onJumpToPage:o.jumpTo,onChapterDeleteSuccess:function(t){return e.onChapterDeleteSuccess(r.id,t)}}))}));var de=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:[0,8]},l.a.createElement(v.a,{span:7},l.a.createElement("label",null,e.label)),l.a.createElement(v.a,{span:17},l.a.createElement($.a,{placeholder:e.placeholder,value:e.value,onChange:function(t){e.onChange(e.label,t.target.value)}}))))};var pe=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:[0,8]},l.a.createElement(v.a,{span:7},l.a.createElement("label",null,e.label)),l.a.createElement(v.a,{span:17},l.a.createElement(K.a,{count:3,value:e.value,onChange:function(t){e.onChange(e.label,t)}}))))},ge=a(537);var be=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:[0,8]},l.a.createElement(v.a,{span:7},l.a.createElement("label",null,e.label)),l.a.createElement(v.a,{span:17},l.a.createElement(ge.a.Group,{onChange:function(t){e.onChange(e.label,t.target.value)},value:e.value,style:{width:"100%"}},l.a.createElement(h.a,null,e.items.map((function(e){return l.a.createElement(v.a,{span:8,key:e},l.a.createElement(ge.a,{key:e,value:e},l.a.createElement("span",{style:{color:"white"}},e)))})))))))},fe=a(539);var Ee=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:[0,8]},l.a.createElement(v.a,{span:7},l.a.createElement("label",null,e.label)),l.a.createElement(v.a,{span:17},l.a.createElement(fe.a,{onChange:function(t){e.onChange(e.label,t.target.checked)},checked:e.value}))))};var he=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:[0,8]},l.a.createElement(v.a,{span:7},l.a.createElement("label",null,e.label)),l.a.createElement(v.a,{span:17},l.a.createElement(h.a,{gutter:2},e.items.map((function(t){return l.a.createElement(v.a,{span:8,key:t},l.a.createElement(Y.a,{key:t,type:e.value.includes(t)?"primary":"link",ghost:!!e.value.includes(t),onClick:function(){return a=t,void e.onChange(e.label,a);var a},style:{width:"100%",textAlign:"left",marginBottom:"2px"}},t))}))))))},ve=a(69),xe=a(195),ye=a(60).default;var Ce=V((function(e){var t=Object(ve.b)("Crud/GetAlbumInfo"),a=t.data,r=t.error,c=Object(n.useState)({albumId:"",path:"",pageCount:0,lastPageIndex:0,album:{title:"",category:"Manga",orientation:"Portrait",artists:[],tags:[],languages:[],flags:[],tier:0,cover:"",isWip:!1,isRead:!1,entryDate:null}}),i=Object(u.a)(c,2),o=i[0],s=i[1];Object(n.useEffect)((function(){void 0!==e.albumId&&ye.get(d+"Crud/GetAlbumVm?id="+e.albumId).then((function(e){console.log("GetAlbumVm response.data",e.data),s(e.data)})).catch((function(t){e.popApiError(t)}))}),[e.albumId]);var m={albumVmChange:function(e,t){var a=Object(T.a)({},o),n=t;"Artists"===e||"Flags"===e?n=t.split(","):"Tags"!==e&&"Languages"!==e||((n=o.album[L(e)]).includes(t)?n=xe.pull(n,t):n.push(t)),a.album[L(e)]=n,s(a)},ok:function(){e.onOk(o)},cancel:function(){e.onCancel()}};return l.a.createElement(q.a,{title:"Edit Metadata",visible:e.isOpen,onOk:m.ok,onCancel:m.cancel},r?"album Info Fetching error":a?l.a.createElement(l.a.Fragment,null,l.a.createElement(de,{label:"Title",value:o.album.title,onChange:m.albumVmChange}),l.a.createElement(de,{label:"Artists",value:o.album.artists.join(),onChange:m.albumVmChange}),l.a.createElement(be,{label:"Category",value:o.album.category,items:a.categories,onChange:m.albumVmChange}),l.a.createElement(be,{label:"Orientation",value:o.album.orientation,items:a.orientations,onChange:m.albumVmChange}),l.a.createElement(pe,{label:"Tier",value:o.album.tier,onChange:m.albumVmChange}),l.a.createElement(de,{label:"Flags",value:o.album.flags.join(),onChange:m.albumVmChange}),l.a.createElement(he,{label:"Tags",value:o.album.tags,items:a.tags,onChange:m.albumVmChange}),l.a.createElement(he,{label:"Languages",value:o.album.languages,items:a.languages,onChange:m.albumVmChange}),l.a.createElement(Ee,{label:"IsRead",value:o.album.isRead,onChange:m.albumVmChange}),l.a.createElement(Ee,{label:"IsWip",value:o.album.isWip,onChange:m.albumVmChange})):"loading...")})),Ie=a(60).default;var ke=V((function(e){var t=Object(n.useState)([]),a=Object(u.a)(t,2),r=a[0],c=a[1];Object(n.useEffect)((function(){window.scrollTo(0,0)}),[]),Object(n.useEffect)((function(){var t=void 0!==e.query?encodeURIComponent(e.query):"";Ie.get(d+"Crud/GetAlbumCardModels?page=0&row=0&query="+t).then((function(e){c(e.data)})).catch((function(t){e.popApiError(t)}))}),[e.query]);var i=Object(n.useState)(!1),o=Object(u.a)(i,2),s=o[0],m=o[1],p=Object(n.useState)({}),g=Object(u.a)(p,2),b=g[0],f=g[1],E={view:function(e){f(e.albumId),m(!0)},close:function(t,a){m(!1),Ie.post(d+"Crud/UpdateAlbumOuterValue/",{albumId:t,lastPageIndex:a}).then((function(e){})).catch((function(t){e.popApiError(t)})),c(r.map((function(e,n){return e.albumId!==t?e:Object(T.a)({},e,{lastPageIndex:a,isRead:a===e.pageCount-1||e.isRead})})))}},x=Object(n.useState)(!1),y=Object(u.a)(x,2),C=y[0],I=y[1],k=Object(n.useState)(void 0),w=Object(u.a)(k,2),j=w[0],O=w[1],A={edit:function(e){console.log("edit album"+e),I(!0),O(e)},delete:function(e){c(r.filter((function(t){return t.albumId!==e})))},pageDeleteSuccess:function(e,t){c(r.map((function(a,n){return a.albumId!==e?a:Object(T.a)({},a,{pageCount:a.pageCount-1,lastPageIndex:t})})))},chapterDeleteSuccess:function(e,t){c(r.map((function(a,n){return a.albumId!==e?a:Object(T.a)({},a,{pageCount:t,lastPageIndex:0})})))}},S={ok:function(t){I(!1),Ie.post(d+"Crud/UpdateAlbum/",t).then((function(e){console.log("edit success. Id: ",e.data);var a=Object(P.a)(r),n=a.findIndex((function(e){return e.albumId===t.albumId}));a[n].fullTitle="[".concat(t.album.artists.join(", "),"] ").concat(t.album.title),a[n].languages=t.album.languages,c(a)})).catch((function(t){e.popApiError(t)}))},cancel:function(){I(!1)}};return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:0,type:"flex"},r.map((function(e,t){return l.a.createElement(v.a,{style:{textAlign:"center"},lg:3,md:6,xs:12,key:"albumCol"+e.albumId},l.a.createElement(Q,{index:t,albumCm:e,onView:E.view,onEdit:A.edit,onDelete:A.delete,showContextMenu:!0}))}))),l.a.createElement(me,{isOpen:s,onClose:E.close,onPageDeleteSuccess:A.pageDeleteSuccess,onChapterDeleteSuccess:A.chapterDeleteSuccess,albumCm:r.find((function(e){return e.albumId===b}))}),l.a.createElement(Ce,{isOpen:C,albumId:j,onOk:S.ok,onCancel:S.cancel}))})),we=a(16),je=a.n(we),Oe=a(33),Ae=(a(60).default,null),Se=function(){var e=Object(Oe.a)(je.a.mark((function e(){return je.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==Ae){e.next=4;break}return e.next=3,qe();case 3:Ae=e.sent;case 4:return e.abrupt("return",Ae.tags);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Pe=function(){var e=Object(Oe.a)(je.a.mark((function e(){return je.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==Ae){e.next=4;break}return e.next=3,qe();case 3:Ae=e.sent;case 4:return e.abrupt("return",Ae.categories);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=Object(Oe.a)(je.a.mark((function e(){return je.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==Ae){e.next=4;break}return e.next=3,qe();case 3:Ae=e.sent;case 4:return e.abrupt("return",Ae.orientations);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Re=function(){var e=Object(Oe.a)(je.a.mark((function e(){return je.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==Ae){e.next=4;break}return e.next=3,qe();case 3:Ae=e.sent;case 4:return e.abrupt("return",Ae.languages);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function qe(){return Fe.apply(this,arguments)}function Fe(){return(Fe=Object(Oe.a)(je.a.mark((function e(){var t;return je.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("FetchAlbumInfo called"),e.next=3,fetch(d+"Crud/GetAlbumInfo",{method:"GET"});case 3:return t=e.sent,e.abrupt("return",t.json());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Me=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:[0,8]},l.a.createElement(v.a,{span:7}),l.a.createElement(v.a,{span:17},l.a.createElement(Y.a,{onClick:function(t){e.onClick(e.label)}},e.label))))},De=a(195);var Ne=function(e){var t,a=Object(n.useState)(""),r=Object(u.a)(a,2),c=(r[0],r[1],Object(n.useState)([])),i=Object(u.a)(c,2),o=i[0],s=i[1],m=Object(n.useState)({title:"",category:"Manga",orientation:"Portrait",artists:[],tags:[],languages:[],flags:[],tier:0,cover:"",isWip:!1,isRead:!1,entryDate:null}),d=Object(u.a)(m,2),p=d[0],g=d[1],b=Object(n.useState)([]),f=Object(u.a)(b,2),E=f[0],x=f[1],y=Object(n.useState)([]),C=Object(u.a)(y,2),I=C[0],k=C[1],w=Object(n.useState)([]),j=Object(u.a)(w,2),O=j[0],A=j[1],S=Object(n.useState)([]),P=Object(u.a)(S,2),R=P[0],q=P[1];function F(e,t){var a=Object(T.a)({},p),n=t;"Artists"===e||"Flags"===e?n=t.split(","):"Tags"!==e&&"Languages"!==e||((n=p[L(e)]).includes(t)?n=De.pull(n,t):n.push(t)),a[L(e)]=n,g(a)}return Object(n.useEffect)((function(){function e(){return(e=Object(Oe.a)(je.a.mark((function e(){var t,a,n,l;return je.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Se();case 2:return t=e.sent,e.next=5,Pe();case 5:return a=e.sent,e.next=8,Te();case 8:return n=e.sent,e.next=11,Re();case 11:l=e.sent,x(t),k(a),A(n),q(l);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}(),(t=document.getElementById("myInput")).onchange=function(){console.log(t),s(t.files)}}),[]),l.a.createElement("div",null,l.a.createElement("h3",null,"Add edit page"),l.a.createElement("br",null),l.a.createElement(h.a,{justify:"start",align:"middle",gutter:[16,24]},l.a.createElement(v.a,{span:12,className:"gutter-row"},l.a.createElement(de,{label:"Title",value:p.title,onChange:F}),l.a.createElement(de,{label:"Artists",value:p.artists.join(),onChange:F}),l.a.createElement(be,{label:"Category",value:p.category,items:I,onChange:F}),l.a.createElement(pe,{label:"Tier",value:p.tier,onChange:F}),l.a.createElement(de,{label:"Flags",value:p.flags.join(),onChange:F}),l.a.createElement(he,{label:"Tags",value:p.tags,items:E,onChange:F}),l.a.createElement(be,{label:"Orientation",value:p.orientation,items:O,onChange:F}),l.a.createElement(he,{label:"Languages",value:p.languages,items:R,onChange:F}),l.a.createElement(Ee,{label:"IsRead",value:p.isRead,onChange:F}),l.a.createElement(Ee,{label:"IsWip",value:p.isWip,onChange:F}),l.a.createElement(Y.a,{onClick:function(){console.log(o[0])}},"Log Webkit Files"),l.a.createElement(Me,{label:"Insert Album",onClick:function(e){console.log(e)}}),l.a.createElement("input",{id:"myInput",type:"file",webkitdirectory:"true",directory:!0,multiple:!0})),l.a.createElement(v.a,{span:12,className:"gutter-row"},l.a.createElement("p",null,"placeholder for image"))))};var ze=function(e){var t="Genres"===e.page?"Crud/GetGenreCardModels":"Artists"===e.page?"Crud/GetArtistCardModels?tier=1":"NotFound",a=Object(ve.b)(t),n=a.data;if(a.error)return l.a.createElement("div",null,"error!");if(!n)return l.a.createElement("div",null,"loading...");var r={view:function(t){console.log("query click",t),e.history.push("/albums?query="+t.albumId)}};return l.a.createElement(l.a.Fragment,null,n.map((function(t,a){return l.a.createElement(h.a,{key:"acgRow"+t.name,gutter:0,type:"flex",style:{border:"1px solid rgb(83, 83, 83)",borderRadius:"8px",paddingTop:"8px",marginBottom:"5px"}},"This feature is cancelled"===e.page?l.a.createElement("div",{style:{position:"relative"}},l.a.createElement("div",{style:{position:"absolute",top:"-18px",left:"10px"}},t.name)):"",t.albumCms.map((function(e){return l.a.createElement(v.a,{style:{textAlign:"center"},lg:3,md:6,xs:12,key:"albumCol"+e.albumId},l.a.createElement(Q,{index:a,albumCm:e,onView:r.view,onEdit:function(){},onDelete:function(){},showContextMenu:!1}))})))})))},Le=a(547),Be=a(548);var Ve=function(e){var t=encodeURIComponent(e.tag.query),a="plus"===e.selectStatus?"#1890ff":"",n="minus"===e.selectStatus?"#1890ff":"";return l.a.createElement("li",{className:"ant-menu-item",role:"menuitem",style:{paddingLeft:"24px",paddingRight:"0px"}},l.a.createElement(h.a,null,l.a.createElement(v.a,{span:5,style:{textAlign:"center"},onClick:function(){return e.onPlus(e.tag.name)}},l.a.createElement(Le.a,{style:{marginRight:"0px",backgroundColor:a}})),l.a.createElement(i.b,{to:"/albums?query="+t},l.a.createElement(v.a,{span:14},l.a.createElement("span",{style:{fontSize:"12px"}},e.tag.name))),l.a.createElement(v.a,{span:5,style:{textAlign:"center"},onClick:function(){return e.onMinus(e.tag.name)}},l.a.createElement(Be.a,{style:{marginRight:"0px",backgroundColor:n}}))))},Ge=a(549),We=a(550),Je=a(245),He=a.n(Je);var Ue=function(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),r=a[0],c=a[1],i=Object(n.useState)(""),o=Object(u.a)(i,2),s=o[0],m=o[1];return Object(n.useEffect)((function(){m(e.query)}),[e.query]),l.a.createElement("div",{style:{paddingLeft:"24px"}},l.a.createElement(Y.a,{type:"link",onClick:function(){return c(!0)},style:{width:"90%",textAlign:"left",padding:"0px"}},l.a.createElement(Ge.a,null),"Query Editor"),l.a.createElement(q.a,{visible:r,onCancel:function(){return c(!1)},closable:!1,footer:l.a.createElement(Y.a,{type:"primary",onClick:function(){c(!1),e.onOk(s)}},l.a.createElement(We.a,null),"Search")},l.a.createElement(He.a,{onChange:function(e){return m(e.target.value)},value:s,autoSize:{minRows:2,maxRows:5}})))},Qe=a(60).default,Ke=(f.a.Header,f.a.Content),Ye=f.a.Footer,$e=f.a.Sider,Xe=E.a.SubMenu;var Ze=Object(o.g)(V((function(e){var t,a,r,c=Object(n.useState)(!1),o=Object(u.a)(c,2),s=o[0],p=o[1],A=Object(n.useState)(!1),P=Object(u.a)(A,2),T=P[0],R=P[1],q=null!==(t=m.a.parse(e.location.search).query)&&void 0!==t?t:"";"Albums"===e.page?(a=l.a.createElement(ke,{query:q}),r="2"):"AlbumAddEdit"===e.page?(a=l.a.createElement(Ne,null),r="1"):"Artists"===e.page?(a=l.a.createElement(ze,{page:e.page,history:e.history}),r="3"):"Genres"===e.page&&(a=l.a.createElement(ze,{page:e.page,history:e.history}),r="4");var F={search:function(e){var t=function(e,t){var a=0;return t.forEach((function(t){a+=e.includes(t)})),1===a}(e.split(",")[0],[":","!",">","<"])?e:"title:"+e;F.goToAlbumList(t)},plus:function(e){var t="tag:"+e,a="tag!"+e,n=(""!==q?q.split(","):[]).filter((function(e,n){return!(e===t||e===a)}));n.push(t);var l=n.join(",");F.goToAlbumList(l)},minus:function(e){var t="tag:"+e,a="tag!"+e,n=(""!==q?q.split(","):[]).filter((function(e,n){return!(e===t||e===a)}));n.push(a);var l=n.join(",");F.goToAlbumList(l)},goToAlbumList:function(t){var a=new URLSearchParams(window.location.search);a.set("query",t),e.history.push("Albums?"+a.toString())}},M={reload:function(){Qe.get(d+"Crud/ReloadDatabase").then((function(t){e.popInfo("ReloadDatabase",t.data)})).catch((function(t){e.popApiError(t)}))},rescan:function(){Qe.get(d+"Crud/RescanDatabase").then((function(t){e.popInfo("RescanDatabase",t.data)})).catch((function(t){e.popApiError(t)}))}},D=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"logo"}),l.a.createElement(Ue,{query:q,onOk:function(e){return F.goToAlbumList(e)}}),l.a.createElement(E.a,{theme:"dark",defaultSelectedKeys:[r],defaultOpenKeys:["sub1"],mode:"inline"},l.a.createElement(E.a.Item,{key:"2"},l.a.createElement(i.b,{to:"/albums"},l.a.createElement(y.a,null),l.a.createElement("span",null,"Albums"))),l.a.createElement(E.a.Item,{key:"3"},l.a.createElement(i.b,{to:"/artists"},l.a.createElement(C.a,null),l.a.createElement("span",null,"Artists"))),l.a.createElement(E.a.Item,{key:"4"},l.a.createElement(i.b,{to:"/genres"},l.a.createElement(I.a,null),l.a.createElement("span",null,"Genres"))),l.a.createElement(Xe,{key:"sub1",title:l.a.createElement(l.a.Fragment,null,l.a.createElement(k.a,null),l.a.createElement("span",null,"Tags"))},l.a.createElement(_e,{onPlus:F.plus,onMinus:F.minus,querStr:q})),l.a.createElement(Xe,{key:"sub2",title:l.a.createElement(l.a.Fragment,null,l.a.createElement(w.a,null),l.a.createElement("span",null,"Actions"))},l.a.createElement("li",{className:"ant-menu-item",role:"menuitem",style:{paddingLeft:"24px",paddingRight:"0px"}},l.a.createElement(h.a,{onClick:M.reload},l.a.createElement(v.a,{span:5,style:{textAlign:"center"}},l.a.createElement(j.a,{style:{marginRight:"0px"}})),l.a.createElement(v.a,{span:14},l.a.createElement("span",{style:{fontSize:"12px"}},"Reload Db")),l.a.createElement(v.a,{span:5,style:{textAlign:"center"}}))),l.a.createElement("li",{className:"ant-menu-item",role:"menuitem",style:{paddingLeft:"24px",paddingRight:"0px"}},l.a.createElement(h.a,{onClick:M.rescan},l.a.createElement(v.a,{span:5,style:{textAlign:"center"}},l.a.createElement(O.a,{style:{marginRight:"0px"}})),l.a.createElement(v.a,{span:14},l.a.createElement("span",{style:{fontSize:"12px"}},"Rescan Db")),l.a.createElement(v.a,{span:5,style:{textAlign:"center"}}))))));return l.a.createElement(ve.a,{value:{revalidateOnFocus:!1,fetcher:function(e){return fetch(d+e).then((function(e){return e.json()}))}}},l.a.createElement(f.a,{style:{minHeight:"100vh"}},l.a.createElement(b,null,l.a.createElement(f.a,{style:{position:"fixed",zIndex:1,width:"100%",backgroundColor:"#001529"}},l.a.createElement("div",{style:{textAlign:"end",lineHeight:0}},l.a.createElement("div",{className:"hamburger-container",onClick:function(){return p(!0)}},l.a.createElement(S.a,{style:{fontSize:"32px"}})))),l.a.createElement(x.a,{placement:"right",closable:!1,onClose:function(){return p(!1)},visible:s},D)),l.a.createElement(g,null,l.a.createElement($e,{collapsible:!0,collapsed:T,onCollapse:function(e){return R(e)}},D)),l.a.createElement(f.a,{className:"site-layout"},l.a.createElement(Ke,null,l.a.createElement(b,null,l.a.createElement("div",{style:{paddingTop:"5x"}},"Padding for mobile")),l.a.createElement("div",{className:"site-layout-background",style:{paddingTop:36,paddingLeft:10,paddingRight:10,minHeight:360}},a)),l.a.createElement(Ye,{style:{textAlign:"center"}},"-----------------"))))})));function _e(e){var t=Object(ve.b)("Crud/GetTagVMs"),a=t.data;return t.error?l.a.createElement("div",null,"error!"):a?l.a.createElement(l.a.Fragment,null,a.map((function(t,a){return l.a.createElement(Ve,{key:t.name,tag:t,onPlus:e.onPlus,onMinus:e.onMinus,selectStatus:et(t.name,e.querStr)})}))):l.a.createElement("div",null,"loading...")}function et(e,t){var a=t.split(",");return a.filter((function(t){return t.toLowerCase().includes("tag:"+e.toLowerCase())})).length>0?"plus":a.filter((function(t){return t.toLowerCase().includes("tag!"+e.toLowerCase())})).length>0?"minus":"none"}var tt=function(){return l.a.createElement("div",{className:"App"},l.a.createElement(i.a,null,l.a.createElement(o.d,null,l.a.createElement(o.b,{exact:!0,path:"/"},l.a.createElement(o.a,{to:"/genres"})),l.a.createElement(o.b,{exact:!0,path:"/albums"},l.a.createElement(Ze,{page:"Albums"})),l.a.createElement(o.b,{exact:!0,path:"/add"},l.a.createElement(Ze,{page:"AlbumAddEdit"})),l.a.createElement(o.b,{exact:!0,path:"/artists"},l.a.createElement(Ze,{page:"Artists"})),l.a.createElement(o.b,{exact:!0,path:"/genres"},l.a.createElement(Ze,{page:"Genres"})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var at=function(){c.a.render(l.a.createElement(tt,{isCordova:!0}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))};window.cordova?document.addEventListener("deviceready",at,!1):at()}},[[250,1,2]]]);
//# sourceMappingURL=main.d53db4f3.chunk.js.map