(this.webpackJsonpcloudui=this.webpackJsonpcloudui||[]).push([[0],{393:function(e,t,a){e.exports=a.p+"static/media/loading.d47e58c7.gif"},415:function(e,t,a){e.exports=a(862)},420:function(e,t,a){},422:function(e,t,a){},862:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(6),c=a.n(r),i=(a(420),a(85)),o=a(101),u=(a(421),a(422),a(9)),s=a(911),m=a(918),d=a(921),p=a(923),f=a(65),g=a(917),b=a(913),h=a(930),E=a(931),v=a(932),y=a(933),x=a(934),C=a(935),k=a(936),I=a(937),w=a(938),O=a(939),j=a(940),A=a(399),N=a.n(A),T=a(398),D=a.n(T),F=a(159),S=a.n(F),P=a(122),L=a(35),R=a(40),M=a(929),q=a(914),z=a(388),V=a(161),B=function(e){return function(t){var a=Object.assign({},t);return l.a.createElement(e,Object.assign({},a,{popInfo:function(e,t,a){b.a.info({title:e,content:l.a.createElement("span",null,t,a?JSON.stringify(a,null,2):""),onOk:function(){},width:500})},popError:function(e,t,a){b.a.error({title:e,content:l.a.createElement("span",null,t,a?JSON.stringify(a,null,2):""),onOk:function(){},width:500})},popApiError:function(e){if(null!=e.response){var t=e.response,a=t.status,n=t.statusText,r=t.data,c={title:"".concat(a," - ").concat(n),content:l.a.createElement("span",null,JSON.stringify(r,null,2)),onOk:function(){},width:500};a>=400&&a<500?b.a.warning(c):b.a.error(c)}else b.a.error(JSON.stringify(e))}}))}};function G(e){return e.charAt(0).toLowerCase()+e.slice(1)}function J(e,t){var a=e/t*100;return a<=100?a:100}var W="https://wkr.azurewebsites.net/",U="https://wkrstorage.file.core.windows.net/library/",Y="?sv=2020-02-10&ss=f&srt=o&sp=r&se=2022-03-08T01:36:14Z&st=2021-05-09T17:36:14Z&spr=https&sig=zNFZiJ0sRJw%2B0wbG5ndCoJF%2FitA03CzK4CNZYiXLvoI%3D",H="".concat(W).concat("PublicCrud","/"),_="".concat(W).concat("PublicFile","/"),K=("".concat(W,"Media/"),function(e,t){var a=t.endsWith(".mp4")?"&xyz=".concat(Number(new Date)):"";return"".concat(U).concat(e,"/").concat(t).concat(Y).concat(a)}),Q=function(e,t){return"".concat(U).concat(e).concat(Y)};function Z(e){return e.onVisible(),l.a.createElement(l.a.Fragment,null)}function X(e,t){var a=3===t?{r:34,g:193,b:195}:2===t?{r:142,g:190,b:121}:{r:253,g:187,b:45},n=e<t?0:1;return"rgba(".concat(a.r,",").concat(a.g,",").concat(a.b,",").concat(n,")")}function $(e,t){return e>t&&(1===t||2===t)?"2px solid black":"0px"}function ee(e){var t={width:"18px",height:"12px",marginRight:"2px",marginBottom:"2px"};return l.a.createElement(l.a.Fragment,null,"English"===e.language?l.a.createElement(V.a.GB,{style:t}):"Japanese"===e.language?l.a.createElement(V.a.JP,{style:t}):"Chinese"===e.language?l.a.createElement(V.a.CN,{style:t}):l.a.createElement(V.a.ID,{style:t}))}var te=B((function(e){var t={view:function(){e.onView(e.albumCm)},edit:function(){e.onEdit(e.albumCm.albumId)}},a=Object(z.a)({threshold:0,rootMargin:"300px 0px 300px 0px"}),n=Object(u.a)(a,3),r=n[0],c=n[1],i=(n[2],l.a.createElement(Z,{onVisible:t.edit}));return l.a.createElement("div",{ref:r,style:{paddingBottom:"8px",position:"relative",textAlign:"center"}},l.a.createElement("div",{style:{height:"150px",width:"100%"}},l.a.createElement("div",{style:{display:"inline-block",position:"relative",height:"150px",width:"100%",maxWidth:"150px",borderLeft:e.albumCm.isRead?"":"1px solid #ddbe14"}},l.a.createElement(q.a,{overlay:i,trigger:["contextMenu"],disabled:!e.showContextMenu},l.a.createElement("img",{onClick:t.view,style:{objectFit:"contain",height:"100%",width:"100%"},src:c?Q(e.albumCm.coverInfo.uncPathEncoded):"",alt:"img"})),e.albumCm.isRead?"":l.a.createElement("div",{style:{position:"absolute",height:0,width:0,left:"0px",top:"0px",borderLeft:"15px solid #ddbe14",borderRight:"15px solid transparent",borderBottom:"15px solid transparent"}}),l.a.createElement("div",{style:{position:"absolute",right:"3px",bottom:"3px",color:"white",lineHeight:"0px"}},e.albumCm.languages.map((function(e,t){return l.a.createElement(ee,{language:e,key:t})}))),l.a.createElement("div",{style:{position:"absolute",right:"0px",bottom:"0px",height:"100%",width:"2px"}},[3,2,1].map((function(t,a){return l.a.createElement("div",{key:"tierBar-".concat(a),style:{width:"100%",height:"33%",backgroundColor:X(e.albumCm.tier,t),borderTop:$(e.albumCm.tier,t)}})}))),l.a.createElement("div",{style:{position:"absolute",left:"0px",bottom:"0px",width:"100%",height:"3px",backgroundColor:"white",display:e.albumCm.lastPageIndex>0?"block":"none"}},l.a.createElement("div",{style:{backgroundColor:"DodgerBlue",height:"100%",width:"".concat(J(e.albumCm.lastPageIndex+1,e.albumCm.pageCount),"%")}})),null!==e.albumCm.note&&""!==e.albumCm.note?l.a.createElement("div",{className:"album-flag"},e.albumCm.note):"",l.a.createElement("div",null))),l.a.createElement("span",{style:{fontSize:"12px",lineHeight:1.1}},e.albumCm.fullTitle))})),ae=a(394),ne=a(916),le=a(924),re=a(925),ce=a(926),ie=a(927),oe=a(928),ue=a(912);var se=function(e){var t,a=Object(n.useState)(""),r=Object(u.a)(a,2),c=r[0],i=r[1];return Object(n.useEffect)((function(){i(e.initialValue)}),[e.initialValue]),l.a.createElement(b.a,{visible:e.visible,footer:null,centered:!0,closable:!1,onCancel:function(){return e.onClose()},style:{maxWidth:300,textAlign:"center"},bodyStyle:{backgroundColor:"grey",border:"1px solid black"}},l.a.createElement(ue.a.TextArea,{value:c,onChange:function(e){return i(e.target.value)},rows:2}),l.a.createElement(f.a,{style:{width:"100%"},type:"primary",onClick:function(){e.onOk(c,e.initialValue),e.onClose()}},null!==(t=e.btnText)&&void 0!==t?t:"Rename"))};var me=function(e){var t=Object(n.useState)(0),a=Object(u.a)(t,2),r=a[0],c=a[1];Object(n.useEffect)((function(){c(e.initialValue+1)}),[e.initialValue]);var i=function(t){c(Math.min(Math.max(t,1),e.albumCm.pageCount))},o=Object(n.useState)(!1),s=Object(u.a)(o,2),m=s[0],g=s[1],h=Object(n.useState)(!1),E=Object(u.a)(h,2),v=E[0],y=E[1],x=Object(n.useState)(0),C=Object(u.a)(x,2),k=C[0],I=C[1];return Object(n.useEffect)((function(){void 0!==e.albumCm&&I(e.albumCm.tier)}),[e.albumCm]),void 0===e.albumCm?l.a.createElement(l.a.Fragment,null):l.a.createElement(l.a.Fragment,null,l.a.createElement(b.a,{visible:e.visible,onCancel:e.onCancel,footer:null,closable:!1,centered:!0,style:{maxWidth:300}},l.a.createElement(d.a,null,l.a.createElement(p.a,{span:24,style:{marginBottom:15,textAlign:"center"}},l.a.createElement(ne.a,{count:3,value:k,onChange:function(t){I(t),e.onTierChange(t)},style:{fontSize:"40px"}})),l.a.createElement(p.a,{span:24},l.a.createElement(f.a,{type:"primary",onClick:function(){return e.onRecount()},style:{width:"100%"}},l.a.createElement(le.a,null),"Recount Pages")),l.a.createElement(p.a,{span:12,style:{textAlign:"left",marginTop:5}},l.a.createElement("input",{type:"number",value:r,onChange:function(e){return i(e.target.value)},style:{width:"97%",padding:"4px",WebkitBoxSizing:"border-box",borderRadius:"5px",color:"black"}})),l.a.createElement(p.a,{span:6,style:{textAlign:"left",marginTop:5}},l.a.createElement(f.a,{type:"ghost",style:{width:"97%",color:"white"},onClick:function(){return i(r-1)}},"-")),l.a.createElement(p.a,{span:6,style:{textAlign:"right",marginTop:5}},l.a.createElement(f.a,{type:"ghost",style:{width:"97%",color:"white"},onClick:function(){return i(r+1)}},"+")),l.a.createElement(p.a,{span:24,style:{marginTop:5}},l.a.createElement(f.a,{type:"primary",onClick:function(){return e.onJump(r-1)},style:{width:"100%"}},l.a.createElement(re.a,null),"Jump")),l.a.createElement(p.a,{span:24,style:{marginTop:5}},l.a.createElement(f.a,{type:"primary",onClick:function(){return e.onUndoJump()},style:{width:"100%"}},l.a.createElement(ce.a,null),"Undo Jump")),l.a.createElement(p.a,{span:24,style:{marginTop:5}},l.a.createElement(f.a,{type:"primary",onClick:function(){e.onCancel(),g(!0)},style:{width:"100%"}},l.a.createElement(ie.a,null),"Rename Page")),l.a.createElement(p.a,{span:24,style:{marginTop:5}},l.a.createElement(f.a,{type:"danger",onClick:function(){e.onCancel(),y(!0)},style:{width:"100%"}},l.a.createElement(oe.a,null),"Delete Page")))),l.a.createElement(se,{visible:m,onClose:function(){return g(!1)},initialValue:e.pageName,onOk:function(t){return e.onRename(t)}}),l.a.createElement(b.a,{visible:v,footer:null,centered:!0,closable:!1,onCancel:function(){return y(!1)},style:{maxWidth:300,textAlign:"center"},bodyStyle:{backgroundColor:"grey",border:"1px solid black"}},l.a.createElement("span",{style:{color:"white"}},"Are you sure to delete this page?"),l.a.createElement(f.a,{type:"danger",onClick:function(){y(!1),e.onDelete()},style:{width:"100%"}},"Delete")))},de=b.a.confirm,pe=a(107).default;var fe=B((function(e){var t=Object(n.useState)([]),a=Object(u.a)(t,2),r=a[0],c=a[1];Object(n.useEffect)((function(){void 0!==e.albumId&&pe.get("".concat(H,"GetAlbumChapters?id=").concat(e.albumId)).then((function(e){c(e.data)})).catch((function(t){e.popApiError(t)}))}),[e.albumId]);var i=function(e){console.log("rename ",e)},o=function(t){console.log("delete ",t),de({title:"Delete chapter ".concat(t,"?"),icon:l.a.createElement(M.a,null),okText:"\xa0\xa0\xa0Yes\xa0\xa0\xa0",okType:"danger",cancelText:"\xa0\xa0\xa0No\xa0\xa0\xa0",onOk:function(){var a=encodeURIComponent(t);pe.delete("".concat(H,"DeleteAlbumChapter/").concat(e.albumId,"/").concat(a)).then((function(a){console.log("newPageCount",a.data),e.onChapterDeleteSuccess(a.data),c(r.filter((function(e){return e.title!==t})))})).catch((function(t){e.popApiError(t)}))},onCancel:function(){}})};return l.a.createElement(g.a,{placement:"left",closable:!1,onClose:e.onClose,visible:e.visible},l.a.createElement("div",{style:{padding:"10px"}},r.map((function(t,a){return l.a.createElement(d.a,{style:{marginBottom:"5px"},key:t.title},l.a.createElement(q.a,{overlay:l.a.createElement(m.a,null,l.a.createElement(m.a.Item,{key:"1",onClick:function(){return i(t.title)}},l.a.createElement(ie.a,null),"Rename"),l.a.createElement(m.a.Item,{key:"2",onClick:function(){return o(t.title)}},l.a.createElement(oe.a,null),"Delete")),trigger:["contextMenu"]},l.a.createElement(p.a,{span:10,onClick:function(){return e.onJumpToPage(t.pageIndex)}},l.a.createElement("img",{style:{objectFit:"contain",width:"100%",maxHeight:"128px",border:"1px solid white"},src:Q(t.pageUncPath),alt:"img"}))),l.a.createElement(p.a,{span:14},l.a.createElement("span",{style:{color:"white"}},t.title)))})),";"))})),ge=a(393),be=a.n(ge),he=a(107).default;var Ee=function(e){return{content:{position:"relative",top:"0%",width:"100%",textAlign:"center",backgroundColor:e?"rgba(200, 200, 200, 0.3)":"rgba(0, 0, 0, 0)"},button:{position:"relative",boxSizing:"border-box",border:e?"1px solid black":"0px"}}},ve=function(e,t){return e?l.a.createElement("span",{style:{textAlign:"center",margin:"auto",textShadow:"-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black"}},t):""};function ye(e){var t=e.isLandscape?{transform:"translatex(calc(50vw - 50%)) translatey(calc(50vh - 50%)) rotate(90deg)",width:"100vh",height:"100vw"}:{transform:"translatex(calc(50vw - 50%)) translatey(calc(50vh - 50%))",width:"100vw",height:"100vh"},a=Object(R.a)({objectFit:"contain"},t),n={objectFit:"contain",height:0,width:0,position:"absolute"};return function(e){if(".webm"===e||".mp4"===e)return!0;return!1}(e.pageInfo.extension)?l.a.createElement("video",{autoPlay:!0,loop:!0,id:e.id,style:"q0"===e.queue?a:n,src:"q0"===e.queue?K(e.albumId,e.pageInfo.uncPathEncoded):""},"video not showing"):l.a.createElement("img",{id:e.id,style:"q0"===e.queue?a:n,src:"q0"===e.queue||"q1"===e.queue?K(e.albumId,e.pageInfo.uncPathEncoded):be.a,alt:"Not loaded"})}var xe=B((function(e){var t=Object(n.useState)({id:null,lpi:0,pages:[],indexes:{cPageI:0,pPageI:0,triad:"zenpen",zenpenIndex:0,chuhenIndex:0,kouhenIndex:0},isLandscape:!1}),a=Object(u.a)(t,2),r=a[0],c=a[1];Object(n.useEffect)((function(){void 0!==e.albumCm&&e.albumCm.albumId!==r.id&&he.get("".concat(_,"GetAlbumPageInfos?id=").concat(e.albumCm.albumId)).then((function(t){c({id:e.albumCm.albumId,lpi:e.albumCm.lastPageIndex,isLandscape:"Landscape"===t.data.orientation,pages:t.data.fileInfos,indexes:null}),e.albumCm.pageCount!==t.data.fileInfos.length&&(console.log("PageCount (".concat(e.albumCm.pageCount,") does not match fileInfos length (").concat(t.data.fileInfos.length,")")),he.get("".concat(H,"RefreshAlbum/").concat(e.albumCm.albumId)).then((function(e){})).catch((function(t){e.popApiError(t)})))})).catch((function(t){e.popApiError(t)}))}),[e.albumCm]),Object(n.useEffect)((function(){var e=r.lpi<r.pages.length?r.lpi:r.pages.length-1;o.jumpTo(e)}),[r.id]),Object(n.useEffect)((function(){return document.addEventListener("keydown",i,!1),function(){document.removeEventListener("keydown",i,!1)}}),[]);var i=function(e){27===e.keyCode&&o.close()},o={jumpTo:function(t,a){var n,l,i,o,u,s=r.pages.length-1,m=null!==(n=null===(l=r.indexes)||void 0===l?void 0:l.cPageI)&&void 0!==n?n:0,d=(i=t,o=0,u=s,Math.max(o,Math.min(i,u))),p=function(){function e(e,t,a,n){return{newTriad:e,zenpenIndex:t,chuhenIndex:a,kouhenIndex:n}}function t(e){var t=r.pages.length;return((d+e)%t+t)%t}return d%3===0?e("zenpen",d,t(1),t(-1)):d%3===1?e("chuhen",t(-1),d,t(1)):d%3===2?e("kouhen",t(1),t(-1),d):void 0}(),f=p.newTriad,g=p.zenpenIndex,b=p.chuhenIndex,h=p.kouhenIndex,E=r.pages;null!==a&&void 0!==a&&(E[a.index]=a.newPageInfo),c({indexes:{cPageI:d,pPageI:m,triad:f,zenpenIndex:g,chuhenIndex:b,kouhenIndex:h},id:r.id,lpi:r.lpi,isLandscape:r.isLandscape,pages:E}),null!=r.id&&t===r.pages.length-1&&he.post("".concat(H,"UpdateAlbumOuterValue"),{albumId:r.id,lastPageIndex:t}).then((function(e){})).catch((function(t){e.popApiError(t)}))},rename:function(t,a){console.log("rename page ".concat(t," with name ").concat(a)),he.post("".concat(_,"RenameFile"),{albumId:r.id,pageIndex:t,newName:a}).then((function(e){var a={index:t,newPageInfo:e.data};console.log(a),o.jumpTo(r.indexes.cPageI-1,a)})).catch((function(t){e.popApiError(t)}))},delete:function(t){he.delete("".concat(_,"DeleteFile/").concat(r.id,"/").concat(t)).then((function(a){e.onPageDeleteSuccess(r.id,t)})).catch((function(t){e.popApiError(t)}))},close:function(){e.onClose(r.id,r.indexes.cPageI)}},s={tierChange:function(t){he.put("".concat(H,"UpdateAlbumTier"),{albumId:r.id,tier:t}).then((function(e){console.log(e.data)})).catch((function(t){e.popApiError(t)}))},recount:function(){he.post("".concat(H,'RecountAlbumPages"'),{albumId:r.id}).then((function(t){console.log("new page count",t.data),e.onChapterDeleteSuccess(r.id,t.data)})).catch((function(t){e.popApiError(t)}))}},m=Object(n.useState)(!1),f=Object(u.a)(m,2),g=f[0],b=f[1],h=Object(n.useState)(!1),E=Object(u.a)(h,2),v=E[0],y=E[1],x={rightTop:function(){r.isLandscape?y(!0):o.close()},rightMid:function(){r.isLandscape||o.jumpTo(r.indexes.cPageI+1)},rightBot:function(){r.isLandscape?o.close():o.jumpTo(r.pages.length-1)},midTop:function(){r.isLandscape&&o.jumpTo(r.indexes.cPageI-1)},midMid:function(){b(!0)},midBot:function(){r.isLandscape&&o.jumpTo(r.indexes.cPageI+1)},leftTop:function(){r.isLandscape?o.jumpTo(0):y(!0)},leftMid:function(){r.isLandscape||o.jumpTo(r.indexes.cPageI-1)},leftBot:function(){r.isLandscape?o.jumpTo(r.pages.length-1):o.jumpTo(0)}},C=Object(ae.useSwipeable)({onSwipedLeft:function(e){o.jumpTo(r.indexes.cPageI+1)},onSwipedRight:function(e){o.jumpTo(r.indexes.cPageI-1)}}),k=null!==r.indexes&&0===r.indexes.cPageI,I=Ee(k),w={side:Object(R.a)({},I.button,{minHeight:.25*window.innerHeight}),mid:Object(R.a)({},I.button,{minHeight:.5*window.innerHeight})};if(null===r.indexes||0===r.pages.length)return l.a.createElement(l.a.Fragment,null);var O="zenpen"===r.indexes.triad?r.pages[r.indexes.zenpenIndex]:"chuhen"===r.indexes.triad?r.pages[r.indexes.chuhenIndex]:"kouhen"===r.indexes.triad?r.pages[r.indexes.kouhenIndex]:null,j=l.a.createElement(ye,{id:"zenpen-page",albumId:r.id,pageInfo:r.pages[r.indexes.zenpenIndex],queue:"zenpen"===r.indexes.triad?"q0":"kouhen"===r.indexes.triad?"q1":"q2",isLandscape:r.isLandscape}),A=l.a.createElement(ye,{id:"chuhen-page",albumId:r.id,pageInfo:r.pages[r.indexes.chuhenIndex],queue:"chuhen"===r.indexes.triad?"q0":"zenpen"===r.indexes.triad?"q1":"q2",isLandscape:r.isLandscape}),N=l.a.createElement(ye,{id:"kouhen-page",albumId:r.id,pageInfo:r.pages[r.indexes.kouhenIndex],queue:"kouhen"===r.indexes.triad?"q0":"chuhen"===r.indexes.triad?"q1":"q2",isLandscape:r.isLandscape});return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"overlay overlay-reader",style:{display:e.isOpen?"block":"none",zIndex:1}},l.a.createElement("div",{style:{height:"100vh",position:"absolute",left:0,top:0}},j,A,N),l.a.createElement("div",{className:"overlay",style:{zIndex:2}},l.a.createElement("div",{className:"overlay-content"},l.a.createElement("span",{className:"with-shadow"},O.name),l.a.createElement("div",{style:{position:"fixed",bottom:"0px",width:"100%",textAlign:"center"}},l.a.createElement("span",{className:"with-shadow"},r.indexes.cPageI+1,"/",r.pages.length)))),l.a.createElement("div",{className:"overlay",style:{zIndex:3}},l.a.createElement("div",Object.assign({style:I.content},C),l.a.createElement(d.a,null,l.a.createElement(p.a,{span:6},l.a.createElement("div",{onClick:x.leftTop,style:w.side},ve(k,"Browse Chapters"))),l.a.createElement(p.a,{span:12},l.a.createElement("div",{onClick:x.midTop,style:w.side})),l.a.createElement(p.a,{span:6},l.a.createElement("div",{onClick:x.rightTop,style:w.side},ve(k,"Close Album")))),l.a.createElement(d.a,null,l.a.createElement(p.a,{span:6},l.a.createElement("div",{onClick:x.leftMid,style:w.mid},ve(k,"Previous Page"))),l.a.createElement(p.a,{span:12},l.a.createElement("div",{onClick:x.midMid,style:w.mid},ve(k,"Context Menu")),l.a.createElement(me,{albumCm:e.albumCm,initialValue:r.indexes.cPageI,pageName:O.name,onTierChange:s.tierChange,onRecount:function(){s.recount(),b(!1)},onJump:function(e){o.jumpTo(e),b(!1)},onUndoJump:function(){o.jumpTo(r.indexes.pPageI),b(!1)},visible:g,onRename:function(e){o.rename(r.indexes.cPageI,e),b(!1)},onDelete:function(){o.delete(r.indexes.cPageI),b(!1)},onCancel:function(){return b(!1)}})),l.a.createElement(p.a,{span:6},l.a.createElement("div",{onClick:x.rightMid,style:w.mid},ve(k,"Next Page")))),l.a.createElement(d.a,null,l.a.createElement(p.a,{span:6},l.a.createElement("div",{onClick:x.leftBot,style:w.side},ve(k,"First Page"))),l.a.createElement(p.a,{span:12},l.a.createElement("div",{onClick:x.midBot,style:w.side})),l.a.createElement(p.a,{span:6},l.a.createElement("div",{onClick:x.rightBot,style:w.side},ve(k,"Last Page"))))))),l.a.createElement(fe,{visible:v,onClose:function(){return y(!1)},albumId:r.id,onJumpToPage:o.jumpTo,onChapterDeleteSuccess:function(t){return e.onChapterDeleteSuccess(r.id,t)}}))}));var Ce=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(d.a,{gutter:[0,8]},l.a.createElement(p.a,{sm:7},l.a.createElement("label",null,e.label)),l.a.createElement(p.a,{sm:17},l.a.createElement(ue.a,{placeholder:e.placeholder,value:e.value,onChange:function(t){e.onChange(e.label,t.target.value)}}))))};var ke=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(d.a,{gutter:[0,8]},l.a.createElement(p.a,{span:7},l.a.createElement("label",null,e.label)),l.a.createElement(p.a,{span:17},l.a.createElement(ne.a,{count:3,value:e.value,onChange:function(t){e.onChange(e.label,t)}}))))},Ie=a(920);var we=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(d.a,{gutter:[0,8]},l.a.createElement(p.a,{sm:7},l.a.createElement("label",null,e.label)),l.a.createElement(p.a,{sm:17},l.a.createElement(Ie.a.Group,{onChange:function(t){e.onChange(e.label,t.target.value)},value:e.value,style:{width:"100%"}},l.a.createElement(d.a,null,e.items.map((function(e){return l.a.createElement(p.a,{span:8,key:e},l.a.createElement(Ie.a,{key:e,value:e},l.a.createElement("span",{style:{color:"white"}},e)))})))))))},Oe=a(922);var je=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(d.a,{gutter:[0,8]},l.a.createElement(p.a,{span:7},l.a.createElement("label",null,e.label)),l.a.createElement(p.a,{span:17},l.a.createElement(Oe.a,{onChange:function(t){e.onChange(e.label,t.target.checked)},checked:e.value}))))};var Ae=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(d.a,{gutter:[0,8]},l.a.createElement(p.a,{sm:7},l.a.createElement("label",null,e.label)),l.a.createElement(p.a,{sm:17},l.a.createElement(d.a,{gutter:2},e.items.map((function(t){return l.a.createElement(p.a,{span:8,key:t},l.a.createElement(f.a,{key:t,type:e.value.includes(t)?"primary":"link",ghost:!!e.value.includes(t),onClick:function(){return a=t,void e.onChange(e.label,a);var a},style:{width:"100%",textAlign:"left",marginBottom:"2px"}},t))}))))))},Ne=a(303),Te=a(107).default;var De=B((function(e){var t=Object(P.b)("".concat(H,"GetAlbumInfo")),a=t.data,r=t.error,c=Object(n.useState)({albumId:"",path:"",pageCount:0,lastPageIndex:0,album:{title:"",category:"Manga",orientation:"Portrait",artists:[],tags:[],languages:[],flags:[],tier:0,cover:"",isWip:!1,isRead:!1,entryDate:null}}),i=Object(u.a)(c,2),o=i[0],s=i[1];Object(n.useEffect)((function(){void 0!==e.albumId&&Te.get("".concat(H,"GetAlbumVm?id=").concat(e.albumId)).then((function(e){s(e.data)})).catch((function(t){e.popApiError(t)}))}),[e.albumId]);var m={albumVmChange:function(e,t){var a=Object(R.a)({},o),n=t;"Artists"===e?n=t.split(","):"Tags"!==e&&"Languages"!==e||((n=o.album[G(e)]).includes(t)?n=Ne.pull(n,t):n.push(t)),a.album[G(e)]=n,s(a)},ok:function(){e.onOk(o)},cancel:function(){e.onCancel()},editFiles:function(){e.onEditFiles(o)},delete:function(){e.onDelete(o)},refresh:function(){e.onRefresh(o)}},g=l.a.createElement("div",{className:"ant-modal-root"},l.a.createElement("div",{className:"ant-modal-mask"}),l.a.createElement("div",{tabIndex:-1,className:"ant-modal-wrap",role:"dialog","aria-labelledby":"rcDialogTitle0",onClick:m.cancel},l.a.createElement("div",{role:"document",className:"my-ant-modal",onClick:function(e){return e.stopPropagation()}},l.a.createElement("div",{className:"ant-modal-content"},l.a.createElement("button",{onClick:m.cancel,type:"button","aria-label":"Close",className:"ant-modal-close"},l.a.createElement("span",{className:"ant-modal-close-x"},l.a.createElement("i",{"aria-label":"icon: close",className:"anticon anticon-close ant-modal-close-icon"},l.a.createElement("svg",{viewBox:"64 64 896 896",focusable:"false",className:"","data-icon":"close",fill:"currentColor","aria-hidden":"true",style:{height:"1em",width:"1em"}},l.a.createElement("path",{d:"M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 0 0 203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z"}))))),l.a.createElement("div",{className:"my-ant-modal-header"},l.a.createElement("div",{className:"my-ant-modal-title",id:"rcDialogTitle0"},"Edit Metadata")),l.a.createElement("div",{className:"my-ant-modal-body"},r?"album Info Fetching error":a?l.a.createElement(l.a.Fragment,null,l.a.createElement(Ce,{label:"Title",value:o.album.title,onChange:m.albumVmChange}),l.a.createElement(Ce,{label:"Artists",value:o.album.artists.join(),onChange:m.albumVmChange}),l.a.createElement(we,{label:"Category",value:o.album.category,items:a.categories,onChange:m.albumVmChange}),l.a.createElement(we,{label:"Orientation",value:o.album.orientation,items:a.orientations,onChange:m.albumVmChange}),l.a.createElement(ke,{label:"Tier",value:o.album.tier,onChange:m.albumVmChange}),l.a.createElement(Ce,{label:"Note",value:o.album.note,onChange:m.albumVmChange}),l.a.createElement(Ae,{label:"Tags",value:o.album.tags,items:a.tags,onChange:m.albumVmChange}),l.a.createElement(Ae,{label:"Languages",value:o.album.languages,items:a.languages,onChange:m.albumVmChange}),l.a.createElement(je,{label:"IsRead",value:o.album.isRead,onChange:m.albumVmChange}),l.a.createElement(je,{label:"IsWip",value:o.album.isWip,onChange:m.albumVmChange})):"loading..."),l.a.createElement("div",{className:"my-ant-modal-footer"},l.a.createElement(d.a,null,l.a.createElement(p.a,{span:5},l.a.createElement(f.a,{onClick:m.delete,type:"danger",style:{width:"100%"}},"Delete")),l.a.createElement(p.a,{span:1}),l.a.createElement(p.a,{span:5},l.a.createElement(f.a,{onClick:m.refresh,type:"ghost",style:{width:"100%",color:"white"}},"Refresh")),l.a.createElement(p.a,{span:2}),l.a.createElement(p.a,{span:5},l.a.createElement(f.a,{onClick:m.editFiles,type:"ghost",style:{width:"100%",color:"white"}},"Files")),l.a.createElement(p.a,{span:1}),l.a.createElement(p.a,{span:5},l.a.createElement(f.a,{onClick:m.ok,type:"primary",style:{width:"100%"}},"Save"))))))));return l.a.createElement(l.a.Fragment,null,e.isOpen?g:"")})),Fe=a(395),Se=b.a.confirm,Pe=a(107).default;var Le=Object(o.g)(B((function(e){console.log("albums rendering"),Object(n.useEffect)((function(){window.scrollTo(0,0)}),[]);var t=Object(n.useState)([]),a=Object(u.a)(t,2),r=a[0],c=a[1],i=function(){return new Promise((function(t,a){var n=e.queryParts,l=n.page,r=n.row,i=n.query,o=void 0!==i?encodeURIComponent(i):"";Pe.get("".concat(H,"GetAlbumCardModels?page=").concat(l,"&row=").concat(r,"&query=").concat(o)).then((function(e){c(e.data),t("param from resolve")})).catch((function(t){e.popApiError(t),a("param from reject")}))}))};Object(n.useEffect)((function(){i()}),[e.queryParts]);var o=Object(n.useState)([]),s=Object(u.a)(o,2),m=s[0],f=s[1];Object(n.useEffect)((function(){var t=null===e.tierFilter?r:r.filter((function(t){return t.tier===e.tierFilter}));f(t)}),[r,e.tierFilter]);var g=Object(n.useState)(!1),b=Object(u.a)(g,2),h=b[0],E=b[1],v=Object(n.useState)({}),y=Object(u.a)(v,2),x=y[0],C=y[1],k={view:function(e){C(e.albumId),E(!0)},close:function(t,a){E(!1),Pe.post("".concat(H,"UpdateAlbumOuterValue"),{albumId:t,lastPageIndex:a}).then((function(e){})).catch((function(t){e.popApiError(t)})),c(r.map((function(e,n){return e.albumId!==t?e:Object(R.a)({},e,{lastPageIndex:a,isRead:a===e.pageCount-1||e.isRead})})))}},I=Object(n.useState)(!1),w=Object(u.a)(I,2),O=w[0],j=w[1],A=Object(n.useState)(void 0),N=Object(u.a)(A,2),T=N[0],D=N[1],F={edit:function(e){j(!0),D(e)},pageDeleteSuccess:function(e,t){c(r.map((function(a,n){return a.albumId!==e?a:Object(R.a)({},a,{pageCount:a.pageCount-1,lastPageIndex:t})})))},chapterDeleteSuccess:function(e,t){c(r.map((function(a,n){return a.albumId!==e?a:Object(R.a)({},a,{pageCount:t,lastPageIndex:0})})))}},S={ok:function(t){j(!1),Pe.post("".concat(H,"UpdateAlbum"),t).then((function(e){console.log("edit success. Id: ",e.data);var a=Object(L.a)(r),n=a.findIndex((function(e){return e.albumId===t.albumId}));a[n].fullTitle="[".concat(t.album.artists.join(", "),"] ").concat(t.album.title),a[n].languages=t.album.languages,a[n].note=t.album.note,c(a)})).catch((function(t){e.popApiError(t)}))},cancel:function(){j(!1)},delete:function(t){var a=t.album;Se({title:"Delete album [".concat(a.artists.join(", "),"] ").concat(a.title,"?"),icon:l.a.createElement(M.a,null),okText:"\xa0\xa0\xa0YES\xa0\xa0\xa0",okType:"danger",cancelText:"\xa0\xa0\xa0NO\xa0\xa0\xa0",onOk:function(){Pe.delete("".concat(H,"DeleteAlbum/").concat(t.albumId)).then((function(e){j(!1),c(r.filter((function(e){return e.albumId!==t.albumId})))})).catch((function(t){j(!1),e.popApiError(t)}))},onCancel:function(){}})},refresh:function(t){j(!1),Pe.get("".concat(H,"RefreshAlbum/").concat(t.albumId)).then((function(t){e.popInfo("Refresh Album",t.data,null)})).catch((function(t){e.popApiError(t)}))},editFiles:function(t){j(!1),e.history.push("FileManagement?id="+t.albumId)}};return l.a.createElement(l.a.Fragment,null,l.a.createElement(Fe.a,{onRefresh:i},l.a.createElement(d.a,{gutter:0,type:"flex"},m.map((function(e,t){return l.a.createElement(p.a,{style:{textAlign:"center"},lg:3,md:6,xs:12,key:"albumCol"+e.albumId},l.a.createElement(te,{index:t,albumCm:e,onView:k.view,onEdit:F.edit,showContextMenu:!0}))})))),l.a.createElement(xe,{isOpen:h,onClose:k.close,onPageDeleteSuccess:F.pageDeleteSuccess,onChapterDeleteSuccess:F.chapterDeleteSuccess,albumCm:r.find((function(e){return e.albumId===x}))}),l.a.createElement(De,{isOpen:O,albumId:T,onOk:S.ok,onCancel:S.cancel,onDelete:S.delete,onRefresh:S.refresh,onEditFiles:S.editFiles}))}))),Re=a(33),Me=a.n(Re),qe=a(67),ze=(a(107).default,null),Ve=function(){var e=Object(qe.a)(Me.a.mark((function e(){return Me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==ze){e.next=4;break}return e.next=3,We();case 3:ze=e.sent;case 4:return e.abrupt("return",ze.tags);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Be=function(){var e=Object(qe.a)(Me.a.mark((function e(){return Me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==ze){e.next=4;break}return e.next=3,We();case 3:ze=e.sent;case 4:return e.abrupt("return",ze.categories);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ge=function(){var e=Object(qe.a)(Me.a.mark((function e(){return Me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==ze){e.next=4;break}return e.next=3,We();case 3:ze=e.sent;case 4:return e.abrupt("return",ze.orientations);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Je=function(){var e=Object(qe.a)(Me.a.mark((function e(){return Me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==ze){e.next=4;break}return e.next=3,We();case 3:ze=e.sent;case 4:return e.abrupt("return",ze.languages);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function We(){return Ue.apply(this,arguments)}function Ue(){return(Ue=Object(qe.a)(Me.a.mark((function e(){var t;return Me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("FetchAlbumInfo called"),e.next=3,fetch(W+"Crud/GetAlbumInfo",{method:"GET"});case 3:return t=e.sent,e.abrupt("return",t.json());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ye=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(d.a,{gutter:[0,8]},l.a.createElement(p.a,{span:7}),l.a.createElement(p.a,{span:17},l.a.createElement(f.a,{onClick:function(t){e.onClick(e.label)}},e.label))))},He=a(303);var _e=function(e){var t,a=Object(n.useState)(""),r=Object(u.a)(a,2),c=(r[0],r[1],Object(n.useState)([])),i=Object(u.a)(c,2),o=i[0],s=i[1],m=Object(n.useState)({title:"",category:"Manga",orientation:"Portrait",artists:[],tags:[],languages:[],flags:[],tier:0,cover:"",isWip:!1,isRead:!1,entryDate:null}),g=Object(u.a)(m,2),b=g[0],h=g[1],E=Object(n.useState)([]),v=Object(u.a)(E,2),y=v[0],x=v[1],C=Object(n.useState)([]),k=Object(u.a)(C,2),I=k[0],w=k[1],O=Object(n.useState)([]),j=Object(u.a)(O,2),A=j[0],N=j[1],T=Object(n.useState)([]),D=Object(u.a)(T,2),F=D[0],S=D[1];function P(e,t){var a=Object(R.a)({},b),n=t;"Artists"===e||"Flags"===e?n=t.split(","):"Tags"!==e&&"Languages"!==e||((n=b[G(e)]).includes(t)?n=He.pull(n,t):n.push(t)),a[G(e)]=n,h(a)}return Object(n.useEffect)((function(){function e(){return(e=Object(qe.a)(Me.a.mark((function e(){var t,a,n,l;return Me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ve();case 2:return t=e.sent,e.next=5,Be();case 5:return a=e.sent,e.next=8,Ge();case 8:return n=e.sent,e.next=11,Je();case 11:l=e.sent,x(t),w(a),N(n),S(l);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}(),(t=document.getElementById("myInput")).onchange=function(){console.log(t),s(t.files)}}),[]),l.a.createElement("div",null,l.a.createElement("h3",null,"Add edit page"),l.a.createElement("br",null),l.a.createElement(d.a,{justify:"start",align:"middle",gutter:[16,24]},l.a.createElement(p.a,{span:12,className:"gutter-row"},l.a.createElement(Ce,{label:"Title",value:b.title,onChange:P}),l.a.createElement(Ce,{label:"Artists",value:b.artists.join(),onChange:P}),l.a.createElement(we,{label:"Category",value:b.category,items:I,onChange:P}),l.a.createElement(ke,{label:"Tier",value:b.tier,onChange:P}),l.a.createElement(Ce,{label:"Flags",value:b.flags.join(),onChange:P}),l.a.createElement(Ae,{label:"Tags",value:b.tags,items:y,onChange:P}),l.a.createElement(we,{label:"Orientation",value:b.orientation,items:A,onChange:P}),l.a.createElement(Ae,{label:"Languages",value:b.languages,items:F,onChange:P}),l.a.createElement(je,{label:"IsRead",value:b.isRead,onChange:P}),l.a.createElement(je,{label:"IsWip",value:b.isWip,onChange:P}),l.a.createElement(f.a,{onClick:function(){console.log(o[0])}},"Log Webkit Files"),l.a.createElement(Ye,{label:"Insert Album",onClick:function(e){console.log(e)}}),l.a.createElement("input",{id:"myInput",type:"file",webkitdirectory:"true",directory:!0,multiple:!0})),l.a.createElement(p.a,{span:12,className:"gutter-row"},l.a.createElement("p",null,"placeholder for image"))))};var Ke=function(e){var t="Genres"===e.page?"GetGenreCardModels":"Artists"===e.page?"GetFeaturedArtistCardModel":"NotFound",a=Object(P.b)("".concat(H).concat(t)),n=a.data;if(a.error)return l.a.createElement("div",null,"error!");if(!n)return l.a.createElement("div",null,"loading...");var r={view:function(t){console.log("query click",t),e.history.push("/albums?query="+t.albumId)}};return l.a.createElement(l.a.Fragment,null,n.map((function(t,a){return l.a.createElement(d.a,{key:"acgRow"+t.name,gutter:0,type:"flex",style:{border:"1px solid rgb(83, 83, 83)",borderRadius:"8px",paddingTop:"8px",marginBottom:"5px"}},"This feature is cancelled"===e.page?l.a.createElement("div",{style:{position:"relative"}},l.a.createElement("div",{style:{position:"absolute",top:"-18px",left:"10px"}},t.name)):"",t.albumCms.map((function(e){return l.a.createElement(p.a,{style:{textAlign:"center"},lg:3,md:6,xs:12,key:"albumCol"+e.albumId},l.a.createElement(te,{index:a,albumCm:e,onView:r.view,onEdit:function(){},onDelete:function(){},showContextMenu:!1}))})))})))},Qe=a(30),Ze=a(334),Xe=a(191),$e=a(401),et=a(209),tt=a.n(et),at=a(216),nt=function(e){var t=e.children;return Object(at.useMediaQuery)({minWidth:801})?t:null},lt=function(e){var t=e.children;return Object(at.useMediaQuery)({maxWidth:800})?t:null},rt=b.a.confirm,ct=a(107).default;var it=B((function(e){var t=Object(Qe.defineFileAction)({id:"custom_rename",requiresSelection:!0,button:{name:"R",toolbar:!0,contextMenu:!0,icon:Qe.ChonkyIconName.code}}),a=[Object(Qe.defineFileAction)({id:"custom_delete",requiresSelection:!0,button:{name:"D",toolbar:!0,contextMenu:!0,icon:Qe.ChonkyIconName.trash}}),t,Object(Qe.defineFileAction)({id:"custom_move",requiresSelection:!0,button:{name:"M",toolbar:!0,contextMenu:!0,icon:Qe.ChonkyIconName.folder}}),Qe.ChonkyActions.EnableGridView,Qe.ChonkyActions.EnableListView,Qe.ChonkyActions.UploadFiles,Qe.ChonkyActions.CreateFolder],r=function t(a,n){ct.post("".concat(_,"NewMoveFile"),a).then((function(e){console.log(e),"Destination file already exist"===e.data.message?rt({title:"Overwrite?",icon:l.a.createElement(M.a,null),content:l.a.createElement(ot,{file1:e.data.srcInfo,file2:e.data.dstInfo}),okText:"\xa0\xa0\xa0YES\xa0\xa0\xa0",okType:"danger",cancelText:"\xa0\xa0\xa0NO\xa0\xa0\xa0",onOk:function(){var e=Object(R.a)({},a,{overwrite:!0});t(e,n)},onCancel:function(){}}):(console.log("Move success",e.data),n(a))})).catch((function(t){e.popApiError(t)}))},c={visible:!1,initialValue:"ad",btnText:null},i=Object(n.useState)(c),o=Object(u.a)(i,2),s=o[0],m=o[1],d=function(e,t){var a={overwrite:!1,src:{albumId:h.albumId,subDir:h.subDir,name:t},dst:{albumId:h.albumId,subDir:h.subDir,name:e}};r(a,(function(e){E((function(t){if(null!==e.src.subDir){var a=t.fsNodes.findIndex((function(t){return t.name===e.src.subDir}));if(e.overwrite){var n=t.fsNodes[a].childs.findIndex((function(t){return t.name===e.dst.name}));t.fsNodes[a].childs.splice(n,1)}var l=t.fsNodes[a].childs.findIndex((function(t){return t.name===e.src.name}));t.fsNodes[a].childs[l].name=e.dst.name}else{if(e.overwrite){var r=t.fsNodes.findIndex((function(t){return t.name===e.dst.name}));t.fsNodes.splice(r,1)}var c=t.fsNodes.findIndex((function(t){return t.name===e.src.name}));t.fsNodes[c].name=e.dst.name}return Object(R.a)({},t)}))}))},p=function(t,a){console.log("folder name",t),E((function(a){return null!==h.subDir&&e.popError("Invalid Operation","Creating folder inside a folder is not allowed"),a.fsNodes.unshift({name:t,size:0,nodeType:0,uncPathEncoded:null,childs:[]}),Object(R.a)({},a)}))},f=[{id:"0",name:"Root",isDir:!0}],g=Object(n.useState)({albumId:null,title:"",subDir:null,fsNodes:[],dirChains:f}),b=Object(u.a)(g,2),h=b[0],E=b[1];Object(n.useEffect)((function(){""!==e.id&&null!==e.id&&void 0!==e.id&&ct.get("".concat(_,"GetAlbumFsNodes?id=").concat(e.id)).then((function(t){E({albumId:e.id,title:t.data.title,subDir:null,fsNodes:t.data.fsNodes,dirChains:f}),console.log(t.data)})).catch((function(t){e.popApiError(t)}))}),[e.id]);var v=Object(n.useState)([]),y=Object(u.a)(v,2),x=y[0],C=y[1];Object(n.useEffect)((function(){var e=(null!==h.subDir?h.fsNodes.find((function(e){return e.name===h.subDir})).childs:h.fsNodes).map((function(e,t){var a;return{id:t+1,name:e.name,isDir:0===e.nodeType,thumbnailUrl:1===e.nodeType?Q(e.uncPathEncoded):null,size:e.size,childrenCount:null===(a=e.childs)||void 0===a?void 0:a.length,selectable:!0,draggable:0!==e.nodeType}}));C(e)}),[h]);var k=Object(at.useMediaQuery)({maxWidth:800})?$e.a:Xe.HTML5Backend;return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{style:{width:"100%",padding:"0px 8px 0px 8px",borderTop:"1px solid grey",borderBottom:"1px solid grey",marginBottom:"2px"}},l.a.createElement("h3",null,h.title)),l.a.createElement("div",{style:{height:"80vh"}},l.a.createElement(Ze.a,{backend:k},l.a.createElement(Qe.FileBrowser,{darkMode:!0,files:x,folderChain:h.dirChains,fileActions:a,disableDragAndDropProvider:!0,disableDefaultFileActions:!0,onFileAction:function(t){if("custom_delete"===t.id){console.log("delete",t);var a=t.state.selectedFiles[0],n=a.isDir?"directory":"file";rt({title:"Delete ".concat(n," ").concat(a.name,"?"),icon:l.a.createElement(M.a,null),okText:"\xa0\xa0\xa0YES\xa0\xa0\xa0",okType:"danger",cancelText:"\xa0\xa0\xa0NO\xa0\xa0\xa0",onOk:function(){var t,n=null===(t=h.dirChains.find((function(e){return"1"===e.id})))||void 0===t?void 0:t.name;console.log("confirm delete ".concat(a.name,", subDir ").concat(n,", albumId ").concat(e.id));var l=function(){function e(e,t,a){return{albumId:e,subDir:t,fileName:a}}return a.isDir?e(h.albumId,a.name,""):e(h.albumId,null!==n&&void 0!==n?n:"",a.name)}();console.log("delete ",l),ct.delete("".concat(_,"Delete?id=").concat(l.albumId,"&subDir=").concat(l.subDir,"&fileName=").concat(l.fileName)).then((function(e){var t=""!==l.subDir&&""===l.fileName?h.fsNodes.filter((function(e){return e.name!==l.subDir})):""===l.subDir&&""!==l.fileName?h.fsNodes.filter((function(e){return e.name!==l.fileName})):""!==l.subDir&&""!==l.fileName?(h.fsNodes.forEach((function(e){e.name===l.subDir&&(e.childs=e.childs.filter((function(e){return e.name!==l.fileName})))})),h.fsNodes):void 0;E((function(e){return Object(R.a)({},e,{fsNodes:t})}))})).catch((function(t){e.popApiError(t)}))},onCancel:function(){}})}else if("custom_rename"===t.id){if(console.log("rename",t),0===t.state.selectedFiles.length)return;m({visible:!0,btnText:"Rename",initialValue:t.state.selectedFiles[0].name,onOk:d})}else if("custom_move"===t.id)console.log("move",t);else if(t.id===Qe.ChonkyActions.EndDragNDrop.id){if(console.log("EndDragNDrop",t),t.payload.draggedFile.isDir)return;if(!t.payload.destination.isDir)return;var c=t.payload.destination.name,i=t.payload.draggedFile.name,o={overwrite:!1,src:{albumId:h.albumId,subDir:h.subDir,name:i},dst:{albumId:h.albumId,subDir:"Root"===c?null:c,name:i}};r(o,(function(e){var t=e.src.name,a=function(){var a=e.src.subDir;if(null!==a){var n=h.fsNodes.findIndex((function(e){return e.name===a})),l=h.fsNodes[n].childs.findIndex((function(e){return e.name===t}));return h.fsNodes[n].childs.splice(l,1)[0]}var r=h.fsNodes.findIndex((function(e){return e.name===t}));return h.fsNodes.splice(r,1)[0]}(),n=e.dst.subDir;if(null!==n){var l=h.fsNodes.findIndex((function(e){return e.name===n}));if(e.overwrite){var r=h.fsNodes[l].childs.findIndex((function(e){return e.name===t}));h.fsNodes[l].childs.splice(r,1)}h.fsNodes[l].childs.push(a),h.fsNodes[l].childs.sort(i)}else{if(e.overwrite){var c=h.fsNodes.findIndex((function(e){return e.name===t}));h.fsNodes.splice(c,1)}h.fsNodes.push(a),h.fsNodes.sort(i)}function i(e,t){if(e.nodeType===t.nodeType){var a=e.name.toLowerCase(),n=t.name.toLowerCase();return a<n?-1:a>n?1:0}return e.nodeType>t.nodeType?1:-1}E((function(e){return Object(R.a)({},e)}))}))}else if(t.id===Qe.ChonkyActions.UploadFiles.id)console.log("Upload",t);else if(t.id===Qe.ChonkyActions.OpenFiles.id){if(!t.payload.targetFile.isDir)return;var u="Root"!==t.payload.targetFile.name?t.payload.targetFile.name:null,s=null!==u?[].concat(Object(L.a)(h.dirChains),[{id:"1",name:u,isDir:!0}]):f;E((function(e){return e.subDir=u,e.dirChains=s,Object(R.a)({},e)}))}else t.id===Qe.ChonkyActions.OpenParentFolder.id?console.log("OpenParentFolder",t):t.id===Qe.ChonkyActions.CreateFolder.id&&m({visible:!0,btnText:"Create Folder",initialValue:"",onOk:p})}},l.a.createElement(Qe.FileNavbar,null),l.a.createElement(Qe.FileToolbar,null),l.a.createElement(Qe.FileList,null),l.a.createElement(Qe.FileContextMenu,null)))),l.a.createElement(se,{visible:s.visible,onClose:function(){return m(c)},initialValue:s.initialValue,onOk:s.onOk,btnText:s.btnText}))}));function ot(e){var t=e.file1,a=e.file2;return l.a.createElement("table",{class:"comparison-table",style:{width:"100%"}},l.a.createElement("tr",null,l.a.createElement("th",null,"Source"),l.a.createElement("th",null,"Destination")),l.a.createElement("tr",null,l.a.createElement("td",null,t.name),l.a.createElement("td",null,a.name)),l.a.createElement("tr",null,l.a.createElement("td",{style:n(t.size,a.size)},(t.size/1024).toFixed(2)," KB"),l.a.createElement("td",{style:n(a.size,t.size)},(a.size/1024).toFixed(2)," KB")),l.a.createElement("tr",null,l.a.createElement("td",{style:n(t.createdDate,a.createdDate)},tt()(t.createdDate).format("YYYY-MM-DD hh:mm")),l.a.createElement("td",{style:n(a.createdDate,t.createdDate)},tt()(a.createdDate).format("YYYY-MM-DD hh:mm"))));function n(e,t){return{fontWeight:e>t?"bold":"normal"}}}var ut=a(107).default,st=(s.a.Header,s.a.Content),mt=s.a.Footer,dt=s.a.Sider,pt=m.a.SubMenu;var ft=Object(o.g)(B((function(e){var t,a,r,c=Object(n.useState)(!1),o=Object(u.a)(c,2),b=o[0],I=o[1],w=Object(n.useState)(!1),O=Object(u.a)(w,2),j=O[0],A=O[1],N=Object(n.useState)(0),T=Object(u.a)(N,2),F=(T[0],T[1]),L=Object(n.useState)(null),R=Object(u.a)(L,2),M=R[0],q=R[1],z=function(e){q(e===M?null:e)},V=null!==(t=S.a.parse(e.location.search).query)&&void 0!==t?t:"",B=null!==(a=S.a.parse(e.location.search).page)&&void 0!==a?a:0,G=null!==(r=S.a.parse(e.location.search).row)&&void 0!==r?r:0;console.log("master page rendering");var J={query:V,page:B,row:G},W=function(){function t(e,t){return{page:e,selectedMenu:t}}if("Albums"===e.page)return t(l.a.createElement(Le,{queryParts:J,tierFilter:M,onAlbumCountChange:F}),"2");if("AlbumAddEdit"===e.page)return t(l.a.createElement(_e,null),"1");if("Artists"===e.page)return t(l.a.createElement(Ke,{page:e.page,history:e.history}),"3");if("Genres"===e.page)return t(l.a.createElement(Ke,{page:e.page,history:e.history}),"4");if("FileManagement"===e.page){var a,n=null!==(a=S.a.parse(e.location.search).id)&&void 0!==a?a:"";return t(l.a.createElement(it,{id:n}),"")}}(),U=W.page,Y=W.selectedMenu,_={search:function(e){var t=function(e,t){var a=0;return t.forEach((function(t){a+=e.includes(t)})),1===a}(e.split(",")[0],[":","!",">","<"])?e:"title:"+e;_.goToAlbumList(t)},plus:function(e){var t="tag:"+e,a="tag!"+e,n=(""!==V?V.split(","):[]).filter((function(e,n){return!(e===t||e===a)}));n.push(t);var l=n.join(",");_.goToAlbumList(l)},minus:function(e){var t="tag:"+e,a="tag!"+e,n=(""!==V?V.split(","):[]).filter((function(e,n){return!(e===t||e===a)}));n.push(a);var l=n.join(",");_.goToAlbumList(l)},goToAlbumList:function(t){var a=new URLSearchParams(window.location.search);a.set("query",t),e.history.push("Albums?"+a.toString())}},K={reload:function(){ut.get("".concat(H,"ReloadDatabase")).then((function(t){e.popInfo("ReloadDatabase",t.data)})).catch((function(t){e.popApiError(t)}))},rescan:function(){ut.get("".concat(H,"RescanDatabase")).then((function(t){e.popInfo("RescanDatabase",t.data)})).catch((function(t){e.popApiError(t)}))}},Q=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"logo"}),l.a.createElement(ht,{query:V,onOk:function(e){return _.goToAlbumList(e)}}),l.a.createElement(m.a,{theme:"dark",defaultSelectedKeys:[Y],defaultOpenKeys:["sub1"],mode:"inline"},l.a.createElement(m.a.Item,{key:"2"},l.a.createElement(i.b,{to:"/albums?page=1&row=100"},l.a.createElement(h.a,null),l.a.createElement("span",null,"Albums"))),l.a.createElement(m.a.Item,{key:"3"},l.a.createElement(i.b,{to:"/artists"},l.a.createElement(E.a,null),l.a.createElement("span",null,"Artists"))),l.a.createElement(m.a.Item,{key:"4"},l.a.createElement(i.b,{to:"/genres"},l.a.createElement(v.a,null),l.a.createElement("span",null,"Genres"))),l.a.createElement(pt,{key:"sub1",title:l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null),l.a.createElement("span",null,"Tags"))},l.a.createElement(gt,{onPlus:_.plus,onMinus:_.minus,querStr:V})),l.a.createElement(pt,{key:"sub2",title:l.a.createElement(l.a.Fragment,null,l.a.createElement(x.a,null),l.a.createElement("span",null,"Actions"))},l.a.createElement("li",{className:"ant-menu-item",role:"menuitem",style:{paddingLeft:"24px",paddingRight:"0px"}},l.a.createElement(d.a,{onClick:K.reload},l.a.createElement(p.a,{span:5,style:{textAlign:"center"}},l.a.createElement(C.a,{style:{marginRight:"0px"}})),l.a.createElement(p.a,{span:14},l.a.createElement("span",{style:{fontSize:"12px"}},"Reload Db")),l.a.createElement(p.a,{span:5,style:{textAlign:"center"}}))),l.a.createElement("li",{className:"ant-menu-item",role:"menuitem",style:{paddingLeft:"24px",paddingRight:"0px"}},l.a.createElement(d.a,{onClick:K.rescan},l.a.createElement(p.a,{span:5,style:{textAlign:"center"}},l.a.createElement(k.a,{style:{marginRight:"0px"}})),l.a.createElement(p.a,{span:14},l.a.createElement("span",{style:{fontSize:"12px"}},"Rescan Db")),l.a.createElement(p.a,{span:5,style:{textAlign:"center"}})))))),Z=function(e,t){var a=t===M;return"type"===e?a?"primary":"link":a};return l.a.createElement(P.a,{value:{revalidateOnFocus:!1,fetcher:function(e){return fetch(e).then((function(e){return e.json()}))}}},l.a.createElement(s.a,{style:{minHeight:"100vh"}},l.a.createElement(lt,null,l.a.createElement(s.a,{className:"mobile-header"},l.a.createElement(d.a,null,l.a.createElement(p.a,{span:6,className:"headerbutton-container"},l.a.createElement(f.a,{onClick:function(){return z(1)},type:Z("type",1),ghost:Z("ghost",1),style:{width:"100%"}},"Tier 1")),l.a.createElement(p.a,{span:6,className:"headerbutton-container"},l.a.createElement(f.a,{onClick:function(){return z(2)},type:Z("type",2),ghost:Z("ghost",2),style:{width:"100%"}},"Tier 2")),l.a.createElement(p.a,{span:6,className:"headerbutton-container"},l.a.createElement(f.a,{onClick:function(){return z(3)},type:Z("type",3),ghost:Z("ghost",3),style:{width:"100%"}},"Tier 3")),l.a.createElement(p.a,{span:6,className:"hamburger-container",onClick:function(){return I(!0)}},l.a.createElement(D.a,{style:{fontSize:"36px"},className:"hamburger"})))),l.a.createElement(g.a,{placement:"right",closable:!1,onClose:function(){return I(!1)},visible:b},Q)),l.a.createElement(nt,null,l.a.createElement(dt,{collapsible:!0,collapsed:j,onCollapse:function(e){return A(e)}},Q)),l.a.createElement(s.a,{className:"site-layout"},l.a.createElement(st,null,l.a.createElement(lt,null,l.a.createElement("div",{style:{paddingTop:"5x"}},"Padding for mobile")),l.a.createElement("div",{className:"site-layout-background",style:{paddingTop:25,paddingLeft:10,paddingRight:10,minHeight:360}},U)),l.a.createElement(mt,{style:{textAlign:"center"}},"-----------------"))))})));function gt(e){var t=Object(P.b)("".concat(H,"GetTagVMs")),a=t.data;return t.error?l.a.createElement("div",null,"error!"):a?l.a.createElement(l.a.Fragment,null,a.map((function(t,a){return l.a.createElement(bt,{key:t.name,tag:t,onPlus:e.onPlus,onMinus:e.onMinus,selectStatus:n(t.name,e.querStr)})}))):l.a.createElement("div",null,"loading...");function n(e,t){var a=t.split(",");return a.filter((function(t){return t.toLowerCase().includes("tag:"+e.toLowerCase())})).length>0?"plus":a.filter((function(t){return t.toLowerCase().includes("tag!"+e.toLowerCase())})).length>0?"minus":"none"}}function bt(e){var t=encodeURIComponent(e.tag.query),a="plus"===e.selectStatus?"#1890ff":"",n="minus"===e.selectStatus?"#1890ff":"";return l.a.createElement("li",{className:"ant-menu-item",role:"menuitem",style:{paddingLeft:"24px",paddingRight:"0px"}},l.a.createElement(d.a,null,l.a.createElement(p.a,{span:5,style:{textAlign:"center"},onClick:function(){return e.onPlus(e.tag.name)}},l.a.createElement(I.a,{style:{marginRight:"0px",backgroundColor:a}})),l.a.createElement(i.b,{to:"/albums?query="+t},l.a.createElement(p.a,{span:14},l.a.createElement("span",{style:{fontSize:"12px"}},e.tag.name))),l.a.createElement(p.a,{span:5,style:{textAlign:"center"},onClick:function(){return e.onMinus(e.tag.name)}},l.a.createElement(w.a,{style:{marginRight:"0px",backgroundColor:n}}))))}function ht(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),r=a[0],c=a[1],i=Object(n.useState)(""),o=Object(u.a)(i,2),s=o[0],m=o[1];return Object(n.useEffect)((function(){m(e.query)}),[e.query]),l.a.createElement("div",{style:{paddingLeft:"24px"}},l.a.createElement(f.a,{type:"link",onClick:function(){return c(!0)},style:{width:"90%",textAlign:"left",padding:"0px"}},l.a.createElement(O.a,null),"Query Editor"),l.a.createElement(b.a,{visible:r,onCancel:function(){return c(!1)},closable:!1,footer:l.a.createElement(f.a,{type:"primary",onClick:function(){c(!1),e.onOk(s)}},l.a.createElement(j.a,null),"Search")},l.a.createElement(N.a,{onChange:function(e){return m(e.target.value)},value:s})))}var Et=function(){return l.a.createElement("div",{className:"App"},l.a.createElement(i.a,null,l.a.createElement(o.d,null,l.a.createElement(o.b,{exact:!0,path:"/"},l.a.createElement(o.a,{to:"/genres"})),l.a.createElement(o.b,{exact:!0,path:"/albums"},l.a.createElement(ft,{page:"Albums"})),l.a.createElement(o.b,{exact:!0,path:"/add"},l.a.createElement(ft,{page:"AlbumAddEdit"})),l.a.createElement(o.b,{exact:!0,path:"/artists"},l.a.createElement(ft,{page:"Artists"})),l.a.createElement(o.b,{exact:!0,path:"/genres"},l.a.createElement(ft,{page:"Genres"})),l.a.createElement(o.b,{exact:!0,path:"/filemanagement"},l.a.createElement(ft,{page:"FileManagement"})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var vt=a(400),yt=function(){Object(Qe.setChonkyDefaults)({iconComponent:vt.ChonkyIconFA}),c.a.render(l.a.createElement(Et,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))};window.cordova?document.addEventListener("deviceready",yt,!1):yt()}},[[415,1,2]]]);
//# sourceMappingURL=main.9b2528fc.chunk.js.map