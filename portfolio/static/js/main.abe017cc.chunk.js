(this.webpackJsonpcloudui=this.webpackJsonpcloudui||[]).push([[0],{243:function(e,t,a){e.exports=a.p+"static/media/loading.d47e58c7.gif"},250:function(e,t,a){e.exports=a(521)},255:function(e,t,a){},257:function(e,t,a){},521:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(4),c=a.n(r),u=(a(255),a(256),a(257),a(45)),o=a(54),i=a(7),m=a(233),s=a.n(m),d="https://ratanajaya.com/",p=a(165),g=function(e){var t=e.children;return Object(p.useMediaQuery)({minWidth:801})?t:null},b=function(e){var t=e.children;return Object(p.useMediaQuery)({maxWidth:800})?t:null},f=a(530),E=a(535),h=a(539),C=a(541),v=a(537),y=a(552),x=a(553),k=a(554),O=a(555),j=a(556),w=a(557),I=a(558),A=a(246),S=a.n(A),T=a(81),R=a(36),P=a(241),q=a(533),F=a(534),M=a(531),N=a(93),D=a(542),L=a(543),z=a(544);function B(e){return e.charAt(0).toLowerCase()+e.slice(1)}function V(e){void 0!==typeof e.response?alert(JSON.stringify(e.response,null,"\t")):alert(JSON.stringify(e,null,"\t"))}function W(e,t){var a=e/t*100;return a<=100?a:100}var G=function(e){return function(t){var a=Object.assign({},t);return l.a.createElement(e,Object.assign({},a,{popInfo:function(e,t,a){q.a.info({title:e,content:l.a.createElement("span",null,t,JSON.stringify(a,null,2)),onOk:function(){},width:500})},popError:function(e,t,a){q.a.error({title:e,content:l.a.createElement("span",null,t,JSON.stringify(a,null,2)),onOk:function(){},width:500})},popApiError:function(e){if(null!=e.response){var t=e.response,a=t.status,n=t.statusText,r=t.data,c={title:"".concat(a," - ").concat(n),content:l.a.createElement("span",null,JSON.stringify(r,null,2)),onOk:function(){},width:500};a>=400&&a<500?q.a.warning(c):q.a.error(c)}else q.a.error(JSON.stringify(e))}}))}},J=q.a.confirm,H=a(60).default;function U(e,t){var a="#fdbb2d";return 1===e?a:2===e?0===t?"#8ebe79":a:3===e?0===t?"#22c1c3":1===t?"#8ebe79":a:"black"}function Q(e){var t={width:"18px",height:"12px",marginRight:"2px",marginBottom:"2px"};return l.a.createElement(l.a.Fragment,null,"English"===e.language?l.a.createElement(N.a.GB,{style:t}):"Japanese"===e.language?l.a.createElement(N.a.JP,{style:t}):"Chinese"===e.language?l.a.createElement(N.a.CN,{style:t}):l.a.createElement(N.a.ID,{style:t}))}var K=G((function(e){var t={view:function(){e.onView(e.albumCm)},edit:function(){e.onEdit(e.albumCm.albumId)},delete:function(){J({title:"Delete album ".concat(e.albumCm.fullTitle,"?"),icon:l.a.createElement(D.a,null),okText:"\xa0\xa0\xa0YES\xa0\xa0\xa0",okType:"danger",cancelText:"\xa0\xa0\xa0NO\xa0\xa0\xa0",onOk:function(){H.delete(d+"Crud/DeleteAlbum/"+e.albumCm.albumId).then((function(t){console.log("del success",t),e.onDelete(e.albumCm.albumId)})).catch((function(t){e.popApiError(t)}))},onCancel:function(){}})}},a=l.a.createElement(E.a,null,l.a.createElement(E.a.Item,{key:"1",onClick:t.edit},l.a.createElement(L.a,null),"Edit"),l.a.createElement(E.a.Item,{key:"2",onClick:t.delete},l.a.createElement(z.a,null),"Delete")),n=Object(P.a)({threshold:0,rootMargin:"150px 0px 150px 0px"}),r=Object(i.a)(n,3),c=r[0],u=r[1];return r[2],l.a.createElement("div",{ref:c,style:{paddingBottom:"8px",position:"relative"}},l.a.createElement(F.a,{overlay:a,trigger:["contextMenu"],disabled:!e.showContextMenu},l.a.createElement("div",{style:{textAlign:"center"}},l.a.createElement("div",{style:{height:"150px",width:"100%"}},l.a.createElement("img",{onClick:t.view,className:"img-contain "+(e.albumCm.isRead?"":"img-highlight"),style:{height:"150px",width:"100%",maxWidth:"150px"},src:u?d+"Media/StreamResizedImage?librelPathBase64="+e.albumCm.coverInfo.uncPathEncoded+"&maxSize=150":"",alt:"img"})),l.a.createElement("div",{style:{position:"absolute",top:"134px",left:"50%",width:"50%",maxWidth:"64px",textAlign:"right"},onClick:t.view},e.albumCm.languages.map((function(e,t){return l.a.createElement(Q,{language:e,key:t})}))),l.a.createElement("div",{style:{position:"absolute",top:"66px",left:"50%",width:"50%",maxWidth:"72px",height:"60px",textAlign:"right",writingMode:"vertical-rl",textOrientation:"upright",color:"#52c41a"},onClick:t.view},l.a.createElement("span",null,Object(T.a)(Array(e.albumCm.tier)).map((function(t,a){return l.a.createElement("span",{key:a,style:{fontWeight:"bold",color:U(e.albumCm.tier,a)}},"l")})))),l.a.createElement("div",{style:{position:"absolute",top:"150px",textAlign:"center",width:"100%"}},e.albumCm.lastPageIndex>0?l.a.createElement(M.a,{percent:W(e.albumCm.lastPageIndex+1,e.albumCm.pageCount),showInfo:!1,strokeWidth:2,style:{paddingLeft:3,paddingRight:3,width:"70%"}}):l.a.createElement(l.a.Fragment,null)),l.a.createElement("span",{style:{fontSize:"12px",lineHeight:1.1}},e.albumCm.fullTitle))))})),Y=a(536),$=a(31),X=a(532),Z=a(545),_=a(546),ee=a(547);var te=function(e){var t=Object(n.useState)(0),a=Object(i.a)(t,2),r=a[0],c=a[1];Object(n.useEffect)((function(){c(e.initialValue+1)}),[e.initialValue]),Object(n.useEffect)((function(){j(e.pageName)}),[e.pageName]);var u=Object(n.useState)(!1),o=Object(i.a)(u,2),m=o[0],s=o[1],d=Object(n.useState)(!1),p=Object(i.a)(d,2),g=p[0],b=p[1],f=Object(n.useState)(0),E=Object(i.a)(f,2),v=E[0],y=E[1];Object(n.useEffect)((function(){y(e.albumCm.tier)}),[e.albumCm]);var x=Object(n.useState)(""),k=Object(i.a)(x,2),O=k[0],j=k[1];return l.a.createElement(l.a.Fragment,null,l.a.createElement(q.a,{visible:e.visible,onCancel:e.onCancel,footer:null,closable:!1,centered:!0,style:{maxWidth:300}},l.a.createElement(h.a,null,l.a.createElement(C.a,{span:24,style:{marginBottom:15,textAlign:"center"}},l.a.createElement(Y.a,{count:3,value:v,onChange:function(t){y(t),e.onTierChange(t)},style:{fontSize:"40px"}})),l.a.createElement(C.a,{span:24},l.a.createElement($.a,{type:"primary",onClick:function(){return e.onRecount()},style:{width:"100%"}},l.a.createElement(Z.a,null),"Recount Pages")),l.a.createElement(C.a,{span:12,style:{textAlign:"left",marginTop:5}},l.a.createElement("input",{type:"number",value:r,onChange:function(t){return c(Math.min(Math.max(t.target.value,1),e.albumCm.pageCount))},style:{width:"97%",padding:"4px",WebkitBoxSizing:"border-box",borderRadius:"5px"}})),l.a.createElement(C.a,{span:12,style:{textAlign:"right",marginTop:5}},l.a.createElement($.a,{type:"primary",onClick:function(){return e.onJump(r-1)},style:{width:"97%",color:"white"}},l.a.createElement(_.a,null),"Jump")),l.a.createElement(C.a,{span:24,style:{marginTop:5}},l.a.createElement($.a,{type:"primary",onClick:function(){return e.onUndoJump()},style:{width:"100%"}},l.a.createElement(ee.a,null),"Undo Jump")),l.a.createElement(C.a,{span:24,style:{marginTop:5}},l.a.createElement($.a,{type:"primary",onClick:function(){e.onCancel(),s(!0)},style:{width:"100%"}},l.a.createElement(L.a,null),"Rename Page")),l.a.createElement(C.a,{span:24,style:{marginTop:5}},l.a.createElement($.a,{type:"danger",onClick:function(){e.onCancel(),b(!0)},style:{width:"100%"}},l.a.createElement(z.a,null),"Delete Page")))),l.a.createElement(q.a,{visible:m,footer:null,centered:!0,closable:!1,onCancel:function(){return s(!1)},style:{maxWidth:300,textAlign:"center"},bodyStyle:{backgroundColor:"grey",border:"1px solid black"}},l.a.createElement(X.a.TextArea,{value:O,onChange:function(e){return j(e.target.value)},rows:2}),l.a.createElement($.a,{type:"primary",onClick:function(){s(!1),e.onRename(O)},style:{width:"100%"}},"Rename")),l.a.createElement(q.a,{visible:g,footer:null,centered:!0,closable:!1,onCancel:function(){return b(!1)},style:{maxWidth:300,textAlign:"center"},bodyStyle:{backgroundColor:"grey",border:"1px solid black"}},l.a.createElement("span",{style:{color:"white"}},"Are you sure to delete this page?"),l.a.createElement($.a,{type:"danger",onClick:function(){b(!1),e.onDelete()},style:{width:"100%"}},"Delete")))},ae=q.a.confirm,ne=a(60).default;var le=G((function(e){var t=Object(n.useState)([]),a=Object(i.a)(t,2),r=a[0],c=a[1];Object(n.useEffect)((function(){void 0!==e.albumId&&ne.get(d+"Crud/GetAlbumChapters?id=".concat(e.albumId)).then((function(e){c(e.data)})).catch((function(t){e.popApiError(t)}))}),[e.albumId]);var u=function(e){console.log("rename ",e)},o=function(t){console.log("delete ",t),ae({title:"Delete chapter ".concat(t,"?"),icon:l.a.createElement(D.a,null),okText:"\xa0\xa0\xa0Yes\xa0\xa0\xa0",okType:"danger",cancelText:"\xa0\xa0\xa0No\xa0\xa0\xa0",onOk:function(){var a=encodeURIComponent(t);ne.delete(d+"Crud/DeleteAlbumChapter/".concat(e.albumId,"/").concat(a)).then((function(a){console.log("newPageCount",a.data),e.onChapterDeleteSuccess(a.data),c(r.filter((function(e){return e.title!==t})))})).catch((function(t){e.popApiError(t)}))},onCancel:function(){}})};return l.a.createElement(v.a,{placement:"left",closable:!1,onClose:e.onClose,visible:e.visible},l.a.createElement("div",{style:{padding:"10px"}},r.map((function(t,a){return l.a.createElement(h.a,{style:{marginBottom:"5px"},key:t.title},l.a.createElement(F.a,{overlay:l.a.createElement(E.a,null,l.a.createElement(E.a.Item,{key:"1",onClick:function(){return u(t.title)}},l.a.createElement(L.a,null),"Rename"),l.a.createElement(E.a.Item,{key:"2",onClick:function(){return o(t.title)}},l.a.createElement(z.a,null),"Delete")),trigger:["contextMenu"]},l.a.createElement(C.a,{span:10,onClick:function(){return e.onJumpToPage(t.pageIndex)}},l.a.createElement("img",{style:{objectFit:"contain",width:"100%",maxHeight:"128px",border:"1px solid white"},src:d+"Media/StreamResizedImage?librelPathBase64="+t.pageUncPath+"&maxSize=128",alt:"img"}))),l.a.createElement(C.a,{span:14},l.a.createElement("span",{style:{color:"white"}},t.title)))})),";"))})),re=a(243),ce=a.n(re),ue=a(244),oe=a(60).default;var ie=function(e){return{content:{position:"relative",top:"0%",width:"100%",textAlign:"center",backgroundColor:e?"rgba(200, 200, 200, 0.3)":"rgba(0, 0, 0, 0)"},button:{position:"relative",boxSizing:"border-box",border:e?"1px solid black":"0px"}}},me=function(e,t){return e?l.a.createElement("span",{style:{textAlign:"center",margin:"auto",textShadow:"-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black"}},t):""};function se(e){var t={height:window.innerHeight,width:window.innerWidth},a={height:0,width:0,position:"absolute"};return function(e){if(".webm"===e||".mp4"===e)return!0;return!1}(e.pageInfo.extension)?l.a.createElement("video",{autoPlay:!0,loop:!0,id:e.id,className:"img-contain",style:"q0"===e.queue?t:a,src:"q0"===e.queue?d+"Media/StreamVideo?librelPathBase64="+e.pageInfo.uncPathEncoded:""},"video not showing"):l.a.createElement("img",{id:e.id,className:"img-contain",style:"q0"===e.queue?t:a,src:"q0"===e.queue||"q1"===e.queue?d+"Media/StreamImage?librelPathBase64="+e.pageInfo.uncPathEncoded:ce.a,alt:"Not loaded"})}var de=G((function(e){var t=Object(n.useRef)(0),a=Object(n.useRef)(0),r=Object(n.useState)({}),c=Object(i.a)(r,2),u=c[0],o=c[1],m=Object(n.useState)({}),s=Object(i.a)(m,2),p=s[0],g=s[1],b=Object(n.useState)({}),f=Object(i.a)(b,2),E=f[0],v=f[1];Object(n.useEffect)((function(){if(void 0!==e.albumCm){console.log("pagecount ",e.albumCm.pageCount);var t=e.albumCm.lastPageIndex<e.albumCm.pageCount?e.albumCm.lastPageIndex:e.albumCm.pageCount-1;k.jumpTo(t)}}),[e.albumCm]),Object(n.useEffect)((function(){return document.addEventListener("keydown",y,!1),function(){document.removeEventListener("keydown",y,!1)}}),[]);var y=function(a){27===a.keyCode&&e.onClose(t.current)},x=Object(n.useRef)("zenpen"),k={jumpTo:function(n){if(void 0!==e.albumCm.albumId){var l,r,c,u=e.albumCm.pageCount-1;a.current=t.current,t.current=(l=n,r=0,c=u,Math.max(r,Math.min(l,c)));var i=function(){function a(e,t,a,n){return{newTriad:e,zenpenIndex:t,chuhenIndex:a,kouhenIndex:n}}var n=t.current;return n%3===0?a("zenpen",n,(n+1)%e.albumCm.pageCount,null):n%3===1?a("chuhen",null,n,(n+1)%e.albumCm.pageCount):n%3===2?a("kouhen",(n+1)%e.albumCm.pageCount,null,n):void 0}(),m=i.newTriad,s=i.zenpenIndex,p=i.chuhenIndex,b=i.kouhenIndex;x.current=m,null!==s&&oe.get(d+"File/GetPageinfo/?id="+e.albumCm.albumId+"&index="+s).then((function(e){o(e.data)})).catch((function(e){V(e)})),null!==p&&oe.get(d+"File/GetPageinfo/?id="+e.albumCm.albumId+"&index="+p).then((function(e){g(e.data)})).catch((function(e){V(e)})),null!==b&&oe.get(d+"File/GetPageinfo/?id="+e.albumCm.albumId+"&index="+b).then((function(e){v(e.data)})).catch((function(e){V(e)}))}},rename:function(a,n){console.log("rename page ".concat(a," with name ").concat(n)),oe.post(d+"File/RenameFile",{albumId:e.albumCm.albumId,pageIndex:a,newName:n}).then((function(e){k.jumpTo(t.current-1)})).catch((function(t){e.popApiError(t)}))},delete:function(t){oe.delete(d+"File/DeleteFile/".concat(e.albumCm.albumId,"/").concat(t)).then((function(a){e.onPageDeleteSuccess(e.albumCm.albumId,t)})).catch((function(t){e.popApiError(t)}))}},O={tierChange:function(t){oe.put(d+"Crud/UpdateAlbumTier",{albumId:e.albumCm.albumId,tier:t}).then((function(e){console.log(e.data)})).catch((function(t){e.popApiError(t)}))},recount:function(){oe.post(d+"Crud/RecountAlbumPages",{albumId:e.albumCm.albumId}).then((function(t){console.log("new page count",t.data),e.onChapterDeleteSuccess(e.albumCm.albumId,t.data)})).catch((function(t){e.popApiError(t)}))}},j=Object(n.useState)(!1),w=Object(i.a)(j,2),I=w[0],A=w[1],S=Object(n.useState)(!1),T=Object(i.a)(S,2),P=T[0],q=T[1],F={rightTop:function(){e.onClose(e.albumCm.albumId,t.current)},rightMid:function(){k.jumpTo(t.current+1)},rightBot:function(){k.jumpTo(e.albumCm.pageCount-1)},midTop:function(){},midMid:function(){A(!0)},midBot:function(){},leftTop:function(){q(!0)},leftMid:function(){k.jumpTo(t.current-1)},leftBot:function(){k.jumpTo(0)}},M=Object(ue.useSwipeable)({onSwipedLeft:function(e){k.jumpTo(t.current+1)},onSwipedRight:function(e){k.jumpTo(t.current-1)}}),N=0===t.current,D=ie(N),L={side:Object(R.a)({},D.button,{minHeight:.25*window.innerHeight}),mid:Object(R.a)({},D.button,{minHeight:.5*window.innerHeight})},z=e.isOpen?"block":"none",B="zenpen"===x.current?u:"chuhen"===x.current?p:"kouhen"===x.current?E:null,W=l.a.createElement(se,{id:"zenpen-page",pageInfo:u,queue:"zenpen"===x.current?"q0":"kouhen"===x.current?"q1":"q2"}),G=l.a.createElement(se,{id:"chuhen-page",pageInfo:p,queue:"chuhen"===x.current?"q0":"zenpen"===x.current?"q1":"q2"}),J=l.a.createElement(se,{id:"kouhen-page",pageInfo:E,queue:"kouhen"===x.current?"q0":"chuhen"===x.current?"q1":"q2"});return void 0===e.albumCm?l.a.createElement(l.a.Fragment,null):l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"overlay overlay-reader",style:{display:z,zIndex:1}},l.a.createElement("div",{className:"overlay-content"},W,G,J),l.a.createElement("div",{className:"overlay",style:{zIndex:2}},l.a.createElement("div",{className:"overlay-content"},l.a.createElement("span",{className:"with-shadow"},B.name),l.a.createElement("div",{style:{position:"fixed",bottom:"0px",width:"100%",textAlign:"center"}},l.a.createElement("span",{className:"with-shadow"},t.current+1,"/",e.albumCm.pageCount)))),l.a.createElement("div",{className:"overlay",style:{zIndex:3}},l.a.createElement("div",Object.assign({style:D.content},M),l.a.createElement(h.a,null,l.a.createElement(C.a,{span:6},l.a.createElement("div",{onClick:F.leftTop,style:L.side},me(N,"Browse Chapters"))),l.a.createElement(C.a,{span:12},l.a.createElement("div",{onClick:F.midTop,style:L.side})),l.a.createElement(C.a,{span:6},l.a.createElement("div",{onClick:F.rightTop,style:L.side},me(N,"Close Album")))),l.a.createElement(h.a,null,l.a.createElement(C.a,{span:6},l.a.createElement("div",{onClick:F.leftMid,style:L.mid},me(N,"Previous Page"))),l.a.createElement(C.a,{span:12},l.a.createElement("div",{onClick:F.midMid,style:L.mid},me(N,"Context Menu")),l.a.createElement(te,{albumCm:e.albumCm,initialValue:t.current,pageName:B.name,onTierChange:O.tierChange,onRecount:function(){O.recount(),A(!1)},onJump:function(e){k.jumpTo(e),A(!1)},onUndoJump:function(){k.jumpTo(a.current),A(!1)},visible:I,onRename:function(e){k.rename(t.current,e),A(!1)},onDelete:function(){k.delete(t.current),A(!1)},onCancel:function(){return A(!1)}})),l.a.createElement(C.a,{span:6},l.a.createElement("div",{onClick:F.rightMid,style:L.mid},me(N,"Next Page")))),l.a.createElement(h.a,null,l.a.createElement(C.a,{span:6},l.a.createElement("div",{onClick:F.leftBot,style:L.side},me(N,"First Page"))),l.a.createElement(C.a,{span:12},l.a.createElement("div",{onClick:F.midBot,style:L.side})),l.a.createElement(C.a,{span:6},l.a.createElement("div",{onClick:F.rightBot,style:L.side},me(N,"Last Page"))))))),l.a.createElement(le,{visible:P,onClose:function(){return q(!1)},albumId:e.albumCm.albumId,onJumpToPage:k.jumpTo,onChapterDeleteSuccess:function(t){return e.onChapterDeleteSuccess(e.albumCm.albumId,t)}}))}));var pe=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:[0,8]},l.a.createElement(C.a,{span:7},l.a.createElement("label",null,e.label)),l.a.createElement(C.a,{span:17},l.a.createElement(X.a,{placeholder:e.placeholder,value:e.value,onChange:function(t){e.onChange(e.label,t.target.value)}}))))};var ge=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:[0,8]},l.a.createElement(C.a,{span:7},l.a.createElement("label",null,e.label)),l.a.createElement(C.a,{span:17},l.a.createElement(Y.a,{count:3,value:e.value,onChange:function(t){e.onChange(e.label,t)}}))))},be=a(538);var fe=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:[0,8]},l.a.createElement(C.a,{span:7},l.a.createElement("label",null,e.label)),l.a.createElement(C.a,{span:17},l.a.createElement(be.a.Group,{onChange:function(t){e.onChange(e.label,t.target.value)},value:e.value,style:{width:"100%"}},l.a.createElement(h.a,null,e.items.map((function(e){return l.a.createElement(C.a,{span:8,key:e},l.a.createElement(be.a,{key:e,value:e},l.a.createElement("span",{style:{color:"white"}},e)))})))))))},Ee=a(540);var he=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:[0,8]},l.a.createElement(C.a,{span:7},l.a.createElement("label",null,e.label)),l.a.createElement(C.a,{span:17},l.a.createElement(Ee.a,{onChange:function(t){e.onChange(e.label,t.target.checked)},checked:e.value}))))};var Ce=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:[0,8]},l.a.createElement(C.a,{span:7},l.a.createElement("label",null,e.label)),l.a.createElement(C.a,{span:17},l.a.createElement(h.a,{gutter:2},e.items.map((function(t){return l.a.createElement(C.a,{span:8,key:t},l.a.createElement($.a,{key:t,type:e.value.includes(t)?"primary":"link",ghost:!!e.value.includes(t),onClick:function(){return a=t,void e.onChange(e.label,a);var a},style:{width:"100%",textAlign:"left",marginBottom:"2px"}},t))}))))))},ve=a(69),ye=a(195),xe=a(60).default;var ke=G((function(e){var t=Object(ve.b)("Crud/GetAlbumInfo"),a=t.data,r=t.error,c=Object(n.useState)({albumId:"",path:"",pageCount:0,lastPageIndex:0,album:{title:"",category:"Manga",orientation:"Portrait",artists:[],tags:[],languages:[],flags:[],tier:0,cover:"",isWip:!1,isRead:!1,entryDate:null}}),u=Object(i.a)(c,2),o=u[0],m=u[1];Object(n.useEffect)((function(){void 0!==e.albumId&&xe.get(d+"Crud/GetAlbumVm?id="+e.albumId).then((function(e){console.log("GetAlbumVm response.data",e.data),m(e.data)})).catch((function(t){e.popApiError(t)}))}),[e.albumId]);var s={albumVmChange:function(e,t){var a=Object(R.a)({},o),n=t;"Artists"===e||"Flags"===e?n=t.split(","):"Tags"!==e&&"Languages"!==e||((n=o.album[B(e)]).includes(t)?n=ye.pull(n,t):n.push(t)),a.album[B(e)]=n,m(a)},ok:function(){e.onOk(o)},cancel:function(){e.onCancel()}};return l.a.createElement(q.a,{title:"Edit Metadata",visible:e.isOpen,onOk:s.ok,onCancel:s.cancel},r?"album Info Fetching error":a?l.a.createElement(l.a.Fragment,null,l.a.createElement(pe,{label:"Title",value:o.album.title,onChange:s.albumVmChange}),l.a.createElement(pe,{label:"Artists",value:o.album.artists.join(),onChange:s.albumVmChange}),l.a.createElement(fe,{label:"Category",value:o.album.category,items:a.categories,onChange:s.albumVmChange}),l.a.createElement(fe,{label:"Orientation",value:o.album.orientation,items:a.orientations,onChange:s.albumVmChange}),l.a.createElement(ge,{label:"Tier",value:o.album.tier,onChange:s.albumVmChange}),l.a.createElement(pe,{label:"Flags",value:o.album.flags.join(),onChange:s.albumVmChange}),l.a.createElement(Ce,{label:"Tags",value:o.album.tags,items:a.tags,onChange:s.albumVmChange}),l.a.createElement(Ce,{label:"Languages",value:o.album.languages,items:a.languages,onChange:s.albumVmChange}),l.a.createElement(he,{label:"IsRead",value:o.album.isRead,onChange:s.albumVmChange}),l.a.createElement(he,{label:"IsWip",value:o.album.isWip,onChange:s.albumVmChange})):"loading...")})),Oe=a(60).default;var je=G((function(e){var t=Object(n.useState)([]),a=Object(i.a)(t,2),r=a[0],c=a[1];Object(n.useEffect)((function(){console.log("scroll effect"),window.scrollTo(0,0)}),[]),Object(n.useEffect)((function(){var t=void 0!==e.query?encodeURIComponent(e.query):"";Oe.get(d+"Crud/GetAlbumCardModels?page=0&row=0&query="+t).then((function(e){c(e.data)})).catch((function(t){e.popApiError(t)}))}),[e.query]);var u=Object(n.useState)(!1),o=Object(i.a)(u,2),m=o[0],s=o[1],p=Object(n.useState)({}),g=Object(i.a)(p,2),b=g[0],f=g[1],E={view:function(e){f(e.albumId),s(!0)},close:function(t,a){s(!1),Oe.post(d+"Crud/UpdateAlbumOuterValue/",{albumId:t,lastPageIndex:a}).then((function(e){})).catch((function(t){e.popApiError(t)})),c(r.map((function(e,n){return e.albumId!==t?e:Object(R.a)({},e,{lastPageIndex:a,isRead:!0})})))}},v=Object(n.useState)(!1),y=Object(i.a)(v,2),x=y[0],k=y[1],O=Object(n.useState)(void 0),j=Object(i.a)(O,2),w=j[0],I=j[1],A={edit:function(e){console.log("edit album"+e),k(!0),I(e)},delete:function(e){c(r.filter((function(t){return t.albumId!==e})))},pageDeleteSuccess:function(e,t){c(r.map((function(a,n){return a.albumId!==e?a:Object(R.a)({},a,{pageCount:a.pageCount-1,lastPageIndex:t})})))},chapterDeleteSuccess:function(e,t){c(r.map((function(a,n){return a.albumId!==e?a:Object(R.a)({},a,{pageCount:t,lastPageIndex:0})})))}},S={ok:function(t){k(!1),Oe.post(d+"Crud/UpdateAlbum/",t).then((function(e){console.log("edit success. Id: ",e.data);var a=Object(T.a)(r),n=a.findIndex((function(e){return e.albumId===t.albumId}));a[n].fullTitle="[".concat(t.album.artists.join(", "),"] ").concat(t.album.title),a[n].languages=t.album.languages,c(a)})).catch((function(t){e.popApiError(t)}))},cancel:function(){k(!1)}};return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:0,type:"flex"},r.map((function(e,t){return l.a.createElement(C.a,{style:{textAlign:"center"},lg:3,md:6,xs:12,key:"albumCol"+e.albumId},l.a.createElement(K,{index:t,albumCm:e,onView:E.view,onEdit:A.edit,onDelete:A.delete,showContextMenu:!0}))}))),l.a.createElement(de,{isOpen:m,onClose:E.close,onPageDeleteSuccess:A.pageDeleteSuccess,onChapterDeleteSuccess:A.chapterDeleteSuccess,albumCm:r.find((function(e){return e.albumId===b}))}),l.a.createElement(ke,{isOpen:x,albumId:w,onOk:S.ok,onCancel:S.cancel}))})),we=a(17),Ie=a.n(we),Ae=a(33),Se=(a(60).default,null),Te=function(){var e=Object(Ae.a)(Ie.a.mark((function e(){return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==Se){e.next=4;break}return e.next=3,Fe();case 3:Se=e.sent;case 4:return e.abrupt("return",Se.tags);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Re=function(){var e=Object(Ae.a)(Ie.a.mark((function e(){return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==Se){e.next=4;break}return e.next=3,Fe();case 3:Se=e.sent;case 4:return e.abrupt("return",Se.categories);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Pe=function(){var e=Object(Ae.a)(Ie.a.mark((function e(){return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==Se){e.next=4;break}return e.next=3,Fe();case 3:Se=e.sent;case 4:return e.abrupt("return",Se.orientations);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),qe=function(){var e=Object(Ae.a)(Ie.a.mark((function e(){return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==Se){e.next=4;break}return e.next=3,Fe();case 3:Se=e.sent;case 4:return e.abrupt("return",Se.languages);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function Fe(){return Me.apply(this,arguments)}function Me(){return(Me=Object(Ae.a)(Ie.a.mark((function e(){var t;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("FetchAlbumInfo called"),e.next=3,fetch(d+"Crud/GetAlbumInfo",{method:"GET"});case 3:return t=e.sent,e.abrupt("return",t.json());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ne=function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(h.a,{gutter:[0,8]},l.a.createElement(C.a,{span:7}),l.a.createElement(C.a,{span:17},l.a.createElement($.a,{onClick:function(t){e.onClick(e.label)}},e.label))))},De=a(195);var Le=function(e){var t,a=Object(n.useState)(""),r=Object(i.a)(a,2),c=(r[0],r[1],Object(n.useState)([])),u=Object(i.a)(c,2),o=u[0],m=u[1],s=Object(n.useState)({title:"",category:"Manga",orientation:"Portrait",artists:[],tags:[],languages:[],flags:[],tier:0,cover:"",isWip:!1,isRead:!1,entryDate:null}),d=Object(i.a)(s,2),p=d[0],g=d[1],b=Object(n.useState)([]),f=Object(i.a)(b,2),E=f[0],v=f[1],y=Object(n.useState)([]),x=Object(i.a)(y,2),k=x[0],O=x[1],j=Object(n.useState)([]),w=Object(i.a)(j,2),I=w[0],A=w[1],S=Object(n.useState)([]),T=Object(i.a)(S,2),P=T[0],q=T[1];function F(e,t){var a=Object(R.a)({},p),n=t;"Artists"===e||"Flags"===e?n=t.split(","):"Tags"!==e&&"Languages"!==e||((n=p[B(e)]).includes(t)?n=De.pull(n,t):n.push(t)),a[B(e)]=n,g(a)}return Object(n.useEffect)((function(){function e(){return(e=Object(Ae.a)(Ie.a.mark((function e(){var t,a,n,l;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te();case 2:return t=e.sent,e.next=5,Re();case 5:return a=e.sent,e.next=8,Pe();case 8:return n=e.sent,e.next=11,qe();case 11:l=e.sent,v(t),O(a),A(n),q(l);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}(),(t=document.getElementById("myInput")).onchange=function(){console.log(t),m(t.files)}}),[]),l.a.createElement("div",null,l.a.createElement("h3",null,"Add edit page"),l.a.createElement("br",null),l.a.createElement(h.a,{justify:"start",align:"middle",gutter:[16,24]},l.a.createElement(C.a,{span:12,className:"gutter-row"},l.a.createElement(pe,{label:"Title",value:p.title,onChange:F}),l.a.createElement(pe,{label:"Artists",value:p.artists.join(),onChange:F}),l.a.createElement(fe,{label:"Category",value:p.category,items:k,onChange:F}),l.a.createElement(ge,{label:"Tier",value:p.tier,onChange:F}),l.a.createElement(pe,{label:"Flags",value:p.flags.join(),onChange:F}),l.a.createElement(Ce,{label:"Tags",value:p.tags,items:E,onChange:F}),l.a.createElement(fe,{label:"Orientation",value:p.orientation,items:I,onChange:F}),l.a.createElement(Ce,{label:"Languages",value:p.languages,items:P,onChange:F}),l.a.createElement(he,{label:"IsRead",value:p.isRead,onChange:F}),l.a.createElement(he,{label:"IsWip",value:p.isWip,onChange:F}),l.a.createElement($.a,{onClick:function(){console.log(o[0])}},"Log Webkit Files"),l.a.createElement(Ne,{label:"Insert Album",onClick:function(e){console.log(e)}}),l.a.createElement("input",{id:"myInput",type:"file",webkitdirectory:"true",directory:!0,multiple:!0})),l.a.createElement(C.a,{span:12,className:"gutter-row"},l.a.createElement("p",null,"placeholder for image"))))};var ze=function(e){var t="Genres"===e.page?"Crud/GetGenreCardModels":"Artists"===e.page?"Crud/GetArtistCardModels?tier=1":"NotFound",a=Object(ve.b)(t),n=a.data;if(a.error)return l.a.createElement("div",null,"error!");if(!n)return l.a.createElement("div",null,"loading...");var r={view:function(t){console.log("query click",t),e.history.push("/albums?query="+t.albumId)}};return l.a.createElement(l.a.Fragment,null,n.map((function(t,a){return l.a.createElement(h.a,{key:"acgRow"+t.name,gutter:0,type:"flex",style:{border:"1px solid rgb(83, 83, 83)",borderRadius:"8px",paddingTop:"8px",marginBottom:"5px"}},"This feature is cancelled"===e.page?l.a.createElement("div",{style:{position:"relative"}},l.a.createElement("div",{style:{position:"absolute",top:"-18px",left:"10px"}},t.name)):"",t.albumCms.map((function(e){return l.a.createElement(C.a,{style:{textAlign:"center"},lg:3,md:6,xs:12,key:"albumCol"+e.albumId},l.a.createElement(K,{index:a,albumCm:e,onView:r.view,onEdit:function(){},onDelete:function(){},showContextMenu:!1}))})))})))},Be=a(548),Ve=a(549);var We=function(e){var t=encodeURIComponent(e.tag.query),a="plus"===e.selectStatus?"#1890ff":"",n="minus"===e.selectStatus?"#1890ff":"";return l.a.createElement("li",{className:"ant-menu-item",role:"menuitem",style:{paddingLeft:"24px",paddingRight:"0px"}},l.a.createElement(h.a,null,l.a.createElement(C.a,{span:5,style:{textAlign:"center"},onClick:function(){return e.onPlus(e.tag.name)}},l.a.createElement(Be.a,{style:{marginRight:"0px",backgroundColor:a}})),l.a.createElement(u.b,{to:"/albums?query="+t},l.a.createElement(C.a,{span:14},l.a.createElement("span",{style:{fontSize:"12px"}},e.tag.name))),l.a.createElement(C.a,{span:5,style:{textAlign:"center"},onClick:function(){return e.onMinus(e.tag.name)}},l.a.createElement(Ve.a,{style:{marginRight:"0px",backgroundColor:n}}))))},Ge=a(550),Je=a(551),He=a(245),Ue=a.n(He);var Qe=function(e){var t=Object(n.useState)(!1),a=Object(i.a)(t,2),r=a[0],c=a[1],u=Object(n.useState)(""),o=Object(i.a)(u,2),m=o[0],s=o[1];return Object(n.useEffect)((function(){s(e.query)}),[e.query]),l.a.createElement("div",{style:{paddingLeft:"24px"}},l.a.createElement($.a,{type:"link",onClick:function(){return c(!0)},style:{width:"90%",textAlign:"left",padding:"0px"}},l.a.createElement(Ge.a,null),"Query Editor"),l.a.createElement(q.a,{visible:r,onCancel:function(){return c(!1)},closable:!1,footer:l.a.createElement($.a,{type:"primary",onClick:function(){c(!1),e.onOk(m)}},l.a.createElement(Je.a,null),"Search")},l.a.createElement(Ue.a,{onChange:function(e){return s(e.target.value)},value:m,autoSize:{minRows:2,maxRows:5}})))},Ke=a(60).default,Ye=(f.a.Header,f.a.Content),$e=f.a.Footer,Xe=f.a.Sider,Ze=E.a.SubMenu;var _e=Object(o.g)(G((function(e){var t,a,r,c=Object(n.useState)(!1),o=Object(i.a)(c,2),m=o[0],p=o[1],A=Object(n.useState)(!1),T=Object(i.a)(A,2),R=T[0],P=T[1],q=null!==(t=s.a.parse(e.location.search).query)&&void 0!==t?t:"";"Albums"===e.page?(a=l.a.createElement(je,{query:q}),r="2"):"AlbumAddEdit"===e.page?(a=l.a.createElement(Le,null),r="1"):"Artists"===e.page?(a=l.a.createElement(ze,{page:e.page,history:e.history}),r="3"):"Genres"===e.page&&(a=l.a.createElement(ze,{page:e.page,history:e.history}),r="4");var F={search:function(e){var t=function(e,t){var a=0;return t.forEach((function(t){a+=e.includes(t)})),1===a}(e.split(",")[0],[":","!",">","<"])?e:"title:"+e;F.goToAlbumList(t)},plus:function(e){var t="tag:"+e,a="tag!"+e,n=(""!==q?q.split(","):[]).filter((function(e,n){return!(e===t||e===a)}));n.push(t);var l=n.join(",");F.goToAlbumList(l)},minus:function(e){var t="tag:"+e,a="tag!"+e,n=(""!==q?q.split(","):[]).filter((function(e,n){return!(e===t||e===a)}));n.push(a);var l=n.join(",");F.goToAlbumList(l)},goToAlbumList:function(t){var a=new URLSearchParams(window.location.search);a.set("query",t),e.history.push("Albums?"+a.toString())}},M={reload:function(){Ke.get(d+"Crud/ReloadDatabase").then((function(t){e.popInfo("ReloadDatabase",t.data)})).catch((function(t){e.popApiError(t)}))},rescan:function(){Ke.get(d+"Crud/RescanDatabase").then((function(t){e.popInfo("ReloadDatabase",t.data)})).catch((function(t){e.popApiError(t)}))}},N=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"logo"}),l.a.createElement(Qe,{query:q,onOk:function(e){return F.goToAlbumList(e)}}),l.a.createElement(E.a,{theme:"dark",defaultSelectedKeys:[r],defaultOpenKeys:["sub1"],mode:"inline"},l.a.createElement(E.a.Item,{key:"2"},l.a.createElement(u.b,{to:"/albums"},l.a.createElement(y.a,null),l.a.createElement("span",null,"Albums"))),l.a.createElement(E.a.Item,{key:"3"},l.a.createElement(u.b,{to:"/artists"},l.a.createElement(x.a,null),l.a.createElement("span",null,"Artists"))),l.a.createElement(E.a.Item,{key:"4"},l.a.createElement(u.b,{to:"/genres"},l.a.createElement(k.a,null),l.a.createElement("span",null,"Genres"))),l.a.createElement(Ze,{key:"sub1",title:l.a.createElement(l.a.Fragment,null,l.a.createElement(O.a,null),l.a.createElement("span",null,"Tags"))},l.a.createElement(et,{onPlus:F.plus,onMinus:F.minus,querStr:q})),l.a.createElement(Ze,{key:"sub2",title:l.a.createElement(l.a.Fragment,null,l.a.createElement(j.a,null),l.a.createElement("span",null,"Actions"))},l.a.createElement("li",{className:"ant-menu-item",role:"menuitem",style:{paddingLeft:"24px",paddingRight:"0px"}},l.a.createElement(h.a,{onClick:M.reload},l.a.createElement(C.a,{span:5,style:{textAlign:"center"}},l.a.createElement(w.a,{style:{marginRight:"0px"}})),l.a.createElement(C.a,{span:14},l.a.createElement("span",{style:{fontSize:"12px"}},"Reload Db")),l.a.createElement(C.a,{span:5,style:{textAlign:"center"}}))),l.a.createElement("li",{className:"ant-menu-item",role:"menuitem",style:{paddingLeft:"24px",paddingRight:"0px"}},l.a.createElement(h.a,{onClick:M.rescan},l.a.createElement(C.a,{span:5,style:{textAlign:"center"}},l.a.createElement(I.a,{style:{marginRight:"0px"}})),l.a.createElement(C.a,{span:14},l.a.createElement("span",{style:{fontSize:"12px"}},"Rescan Db")),l.a.createElement(C.a,{span:5,style:{textAlign:"center"}}))))));return l.a.createElement(ve.a,{value:{revalidateOnFocus:!1,fetcher:function(e){return fetch(d+e).then((function(e){return e.json()}))}}},l.a.createElement(f.a,{style:{minHeight:"100vh"}},l.a.createElement(b,null,l.a.createElement(f.a,{style:{position:"fixed",zIndex:1,width:"100%",backgroundColor:"#001529"}},l.a.createElement("div",{style:{textAlign:"end",lineHeight:0}},l.a.createElement("div",{className:"hamburger-container",onClick:function(){return p(!0)}},l.a.createElement(S.a,{style:{fontSize:"32px"}})))),l.a.createElement(v.a,{placement:"right",closable:!1,onClose:function(){return p(!1)},visible:m},N)),l.a.createElement(g,null,l.a.createElement(Xe,{collapsible:!0,collapsed:R,onCollapse:function(e){return P(e)}},N)),l.a.createElement(f.a,{className:"site-layout"},l.a.createElement(Ye,null,l.a.createElement(b,null,l.a.createElement("div",{style:{paddingTop:"5x"}},"Padding for mobile")),l.a.createElement("div",{className:"site-layout-background",style:{paddingTop:36,paddingLeft:10,paddingRight:10,minHeight:360}},a)),l.a.createElement($e,{style:{textAlign:"center"}},"-----------------"))))})));function et(e){var t=Object(ve.b)("Crud/GetTagVMs"),a=t.data;return t.error?l.a.createElement("div",null,"error!"):a?l.a.createElement(l.a.Fragment,null,a.map((function(t,a){return l.a.createElement(We,{key:t.name,tag:t,onPlus:e.onPlus,onMinus:e.onMinus,selectStatus:tt(t.name,e.querStr)})}))):l.a.createElement("div",null,"loading...")}function tt(e,t){var a=t.split(",");return a.filter((function(t){return t.toLowerCase().includes("tag:"+e.toLowerCase())})).length>0?"plus":a.filter((function(t){return t.toLowerCase().includes("tag!"+e.toLowerCase())})).length>0?"minus":"none"}var at=function(){return l.a.createElement("div",{className:"App"},l.a.createElement(u.a,null,l.a.createElement(o.d,null,l.a.createElement(o.b,{exact:!0,path:"/"},l.a.createElement(o.a,{to:"/genres"})),l.a.createElement(o.b,{exact:!0,path:"/albums"},l.a.createElement(_e,{page:"Albums"})),l.a.createElement(o.b,{exact:!0,path:"/add"},l.a.createElement(_e,{page:"AlbumAddEdit"})),l.a.createElement(o.b,{exact:!0,path:"/artists"},l.a.createElement(_e,{page:"Artists"})),l.a.createElement(o.b,{exact:!0,path:"/genres"},l.a.createElement(_e,{page:"Genres"})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var nt=function(){c.a.render(l.a.createElement(at,{isCordova:!0}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))};window.cordova?document.addEventListener("deviceready",nt,!1):nt()}},[[250,1,2]]]);
//# sourceMappingURL=main.abe017cc.chunk.js.map